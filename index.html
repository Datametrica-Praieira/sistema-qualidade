<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Qualidade Interna - Datam√©trica</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='g1' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%235A5A5A'/%3E%3Cstop offset='100%25' style='stop-color:%233A3A3A'/%3E%3C/linearGradient%3E%3ClinearGradient id='g2' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23E63946'/%3E%3Cstop offset='100%25' style='stop-color:%23C41E2A'/%3E%3C/linearGradient%3E%3ClinearGradient id='g3' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23A0A0A0'/%3E%3Cstop offset='100%25' style='stop-color:%237A7A7A'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='100' height='100' fill='%23F8F9FA'/%3E%3Ctext x='50' y='42' font-family='Arial' font-size='28' font-weight='900' fill='%23E63946' text-anchor='middle'%3EDTM%3C/text%3E%3Crect x='20' y='60' width='15' height='15' fill='url(%23g1)' rx='2'/%3E%3Crect x='42.5' y='60' width='15' height='15' fill='url(%23g2)' rx='2'/%3E%3Crect x='65' y='60' width='15' height='15' fill='url(%23g3)' rx='2'/%3E%3C/svg%3E">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(230, 57, 70, 0.1) 0%, transparent 70%);
            animation: rotate 30s linear infinite;
            pointer-events: none;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            overflow: hidden;
            position: relative;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header {
            background: linear-gradient(135deg, #E63946 0%, #FF6B6B 50%, #E63946 100%);
            color: white;
            padding: 40px 30px 45px 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%) translateY(-100%); }
            100% { transform: translateX(100%) translateY(100%); }
        }

        .logo-container {
            margin-bottom: 25px;
            position: relative;
            z-index: 1;
        }

        .logo-container h1 {
            font-size: 40px;
            color: white;
            font-weight: 700;
            letter-spacing: 3px;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .logo-container p {
            font-size: 15px;
            color: rgba(255,255,255,0.95);
            font-weight: 400;
            letter-spacing: 2px;
            text-transform: lowercase;
        }

        .logo-graphic {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 12px;
        }

        .logo-square {
            width: 18px;
            height: 18px;
            border-radius: 3px;
            animation: pulse-square 2s infinite;
        }

        @keyframes pulse-square {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .square-gray1 { background: white; opacity: 0.8; }
        .square-gray2 { background: white; opacity: 0.6; }
        .square-red { background: white; }

        .header h1 {
            font-size: 32px;
            margin-bottom: 8px;
            font-weight: 600;
            letter-spacing: 1px;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 16px;
            font-weight: 400;
            color: rgba(255,255,255,0.95);
            position: relative;
            z-index: 1;
        }

        .user-info {
            background: linear-gradient(90deg, #5A5A5A 0%, #6C757D 100%);
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 3px solid #E63946;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .user-name {
            font-weight: 600;
            color: white;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-name::before {
            content: 'üë§';
            font-size: 20px;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .user-name span {
            color: white;
            font-weight: 700;
        }

        .admin-badge {
            display: inline-block;
            background: linear-gradient(135deg, #FFD93D 0%, #FFC700 100%);
            color: #333;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            box-shadow: 0 4px 15px rgba(255, 217, 61, 0.4);
            animation: pulse-admin 2s infinite;
        }

        @keyframes pulse-admin {
            0%, 100% {
                box-shadow: 0 4px 15px rgba(255, 217, 61, 0.4);
            }
            50% {
                box-shadow: 0 4px 20px rgba(255, 217, 61, 0.6);
            }
        }

        .btn-logout {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.3s;
        }

        .btn-change-password {
            background: rgba(255, 217, 61, 0.2);
            color: white;
            padding: 8px 16px;
            border: 2px solid rgba(255, 217, 61, 0.5);
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.3s;
        }

        .btn-change-password:hover {
            background: rgba(255, 217, 61, 0.3);
            border-color: rgba(255, 217, 61, 0.7);
            transform: translateY(-1px);
        }

        .btn-logout:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-1px);
        }

        .btn-logout:active {
            transform: translateY(0);
        }

        .login-screen {
            padding: 80px 40px;
            max-width: 500px;
            margin: 0 auto;
            background: linear-gradient(135deg, rgba(230, 57, 70, 0.02) 0%, rgba(255, 107, 107, 0.02) 100%);
            border-radius: 20px;
        }

        .login-screen h2 {
            text-align: center;
            background: linear-gradient(135deg, #E63946 0%, #FF6B6B 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 40px;
            font-size: 28px;
            font-weight: 800;
            letter-spacing: 1px;
        }

        .config-banner {
            background: linear-gradient(135deg, #FFF3CD 0%, #FFE8A1 100%);
            border-left: 4px solid #E63946;
            padding: 25px;
            margin: 20px;
            border-radius: 15px;
            display: none;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            position: relative;
        }

        .config-banner.show {
            display: block;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .config-banner h3 {
            color: #856404;
            margin-bottom: 15px;
            font-size: 20px;
            font-weight: 700;
        }

        .config-banner p {
            color: #856404;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .config-banner input {
            width: 100%;
            padding: 14px;
            margin: 10px 0;
            border: 2px solid #E63946;
            border-radius: 12px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .config-banner input:focus {
            outline: none;
            box-shadow: 0 0 0 4px rgba(230, 57, 70, 0.1);
        }

        .config-banner button {
            background: linear-gradient(135deg, #E63946 0%, #FF6B6B 100%);
            color: white;
            padding: 14px 28px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s;
            box-shadow: 0 6px 20px rgba(230, 57, 70, 0.3);
        }

        .config-banner button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(230, 57, 70, 0.5);
        }

        .config-banner-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 24px;
            color: #856404;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .config-banner-close:hover {
            background: rgba(230, 57, 70, 0.1);
            transform: rotate(90deg);
        }

        .tabs {
            display: flex;
            background: linear-gradient(90deg, #f5f7fa 0%, #e9ecef 100%);
            border-bottom: 3px solid #E5E5E5;
            box-shadow: inset 0 -2px 5px rgba(0,0,0,0.05);
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            font-weight: 700;
            color: #6C757D;
            transition: all 0.3s;
            border: none;
            background: transparent;
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
        }

        .tab::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 3px;
            background: linear-gradient(90deg, #E63946, #FF6B6B);
            transition: width 0.3s;
        }

        .tab.active {
            background: linear-gradient(135deg, #E63946 0%, #FF6B6B 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(230, 57, 70, 0.3);
        }

        .tab.active::after {
            width: 80%;
        }

        .tab:hover:not(.active) {
            background: white;
            color: #E63946;
            transform: translateY(-2px);
        }

        .tab:hover:not(.active)::after {
            width: 60%;
        }

        .content {
            padding: 40px 30px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 28px;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #2C3E50;
            font-size: 15px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 13px;
        }

        input[type="text"],
        input[type="password"],
        select {
            width: 100%;
            padding: 16px;
            border: 2px solid #E5E5E5;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s;
            font-family: 'Segoe UI', sans-serif;
            background: white;
        }

        input[type="text"]:focus,
        input[type="password"]:focus,
        select:focus {
            outline: none;
            border-color: #E63946;
            box-shadow: 0 0 0 4px rgba(230, 57, 70, 0.1);
            transform: translateY(-2px);
        }

        input[type="text"]:disabled {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: #5A5A5A;
            font-weight: 600;
            cursor: not-allowed;
        }

        .camera-container {
            position: relative;
            background: #000;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 15px;
            border: 2px solid #DEE2E6;
        }

        #video {
            width: 100%;
            display: block;
        }

        #preview {
            width: 100%;
            display: none;
            border-radius: 4px;
        }

        .camera-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        button {
            padding: 14px 28px;
            border: none;
            border-radius: 50px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }

        button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        button:active::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #E63946 0%, #FF6B6B 100%);
            color: white;
            box-shadow: 0 6px 20px rgba(230, 57, 70, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(230, 57, 70, 0.5);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6C757D 0%, #8B9299 100%);
            color: white;
            box-shadow: 0 6px 20px rgba(108, 117, 125, 0.3);
        }

        .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(108, 117, 125, 0.4);
        }

        /* Slider com gradiente de cores */
        .slider-container {
            padding: 10px;
        }

        .color-slider {
            -webkit-appearance: none;
            width: 100%;
            height: 15px;
            border-radius: 10px;
            background: linear-gradient(to right, #E63946 0%, #FFD93D 50%, #6BCF7F 100%);
            outline: none;
            cursor: pointer;
        }

        .color-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: white;
            border: 3px solid #2C3E50;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        .color-slider::-moz-range-thumb {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: white;
            border: 3px solid #2C3E50;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #E63946 0%, #FF6B6B 100%);
            color: white;
            font-size: 18px;
            padding: 20px;
            margin-top: 10px;
            box-shadow: 0 8px 30px rgba(230, 57, 70, 0.4);
            animation: pulse-button 2s infinite;
        }

        @keyframes pulse-button {
            0%, 100% {
                box-shadow: 0 8px 30px rgba(230, 57, 70, 0.4);
            }
            50% {
                box-shadow: 0 8px 40px rgba(230, 57, 70, 0.6);
            }
        }

        .btn-success:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 12px 40px rgba(230, 57, 70, 0.6);
        }

        .btn-success:disabled {
            background: linear-gradient(135deg, #ccc 0%, #aaa 100%);
            cursor: not-allowed;
            transform: none;
            animation: none;
        }

        .records-list {
            max-height: 600px;
            overflow-y: auto;
        }

        .record-card {
            background: linear-gradient(135deg, white 0%, #f8f9fa 100%);
            border-radius: 15px;
            padding: 20px 24px;
            margin-bottom: 15px;
            border-left: 6px solid #E63946;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            position: relative;
            overflow: hidden;
        }

        .record-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: -50px;
            width: 100px;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(230, 57, 70, 0.05));
            transform: skewX(-15deg);
            transition: right 0.5s;
        }

        .record-card:hover::before {
            right: 100%;
        }

        .record-card:hover {
            transform: translateX(8px) translateY(-2px);
            box-shadow: 0 8px 25px rgba(230, 57, 70, 0.2);
            border-left-width: 8px;
        }

        .record-header {
            display: grid;
            grid-template-columns: 2fr 1.5fr 1fr;
            gap: 15px;
            align-items: center;
        }

        .record-name {
            font-size: 16px;
            font-weight: 700;
            color: #2C3E50;
        }

        .record-local {
            font-size: 14px;
            color: #5A5A5A;
            font-weight: 600;
        }

        .record-time {
            color: #888;
            font-size: 13px;
            font-weight: 600;
            text-align: right;
        }

        .record-photo a,
        .record-signature a {
            color: #E63946;
            text-decoration: none;
            font-weight: 600;
        }

        .record-photo a:hover,
        .record-signature a:hover {
            text-decoration: underline;
        }

        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: #6C757D;
        }

        .empty-state svg {
            width: 100px;
            height: 100px;
            margin-bottom: 20px;
            opacity: 0.2;
            color: #E63946;
        }

        .empty-state h3 {
            font-size: 24px;
            margin-bottom: 10px;
            color: #2C3E50;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #E63946 0%, #FF6B6B 50%, #E63946 100%);
            color: white;
            padding: 35px 28px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(230, 57, 70, 0.3);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate-stat 8s linear infinite;
        }

        @keyframes rotate-stat {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .stat-card:hover {
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 15px 40px rgba(230, 57, 70, 0.5);
        }

        .stat-value {
            font-size: 48px;
            font-weight: 800;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .stat-label {
            font-size: 13px;
            opacity: 0.95;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            font-weight: 700;
            position: relative;
            z-index: 1;
        }

        .export-btn {
            margin-bottom: 25px;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 30px;
            color: #E63946;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #E63946;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .status-online {
            display: inline-block;
            width: 12px;
            height: 12px;
            background: #28a745;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }

        .status-offline {
            display: inline-block;
            width: 12px;
            height: 12px;
            background: #dc3545;
            border-radius: 50%;
            margin-right: 8px;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .footer {
            background: linear-gradient(90deg, #5A5A5A 0%, #6C757D 100%);
            color: white;
            padding: 25px;
            text-align: center;
            font-size: 13px;
            border-top: 4px solid #E63946;
            font-weight: 500;
            letter-spacing: 0.5px;
            position: relative;
        }

        .settings-link {
            position: absolute;
            bottom: 8px;
            right: 15px;
            font-size: 11px;
            color: rgba(255,255,255,0.4);
            text-decoration: none;
            cursor: pointer;
            transition: all 0.3s;
        }

        .settings-link:hover {
            color: rgba(255,255,255,0.8);
        }

        .hidden {
            display: none !important;
        }

        /* Modal de Sucesso */
        .success-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            z-index: 9999;
            animation: fadeIn 0.3s ease-out;
        }

        .success-modal.show {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes bounceIn {
            0% {
                transform: scale(0.3);
                opacity: 0;
            }
            50% {
                transform: scale(1.05);
            }
            70% {
                transform: scale(0.9);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .success-modal-content {
            background: white;
            border-radius: 30px;
            padding: 50px 60px;
            text-align: center;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.4s ease-out;
            position: relative;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .success-icon {
            width: 100px;
            height: 100px;
            margin: 0 auto 30px;
            background: linear-gradient(135deg, #E63946 0%, #FF6B6B 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 50px;
            animation: scaleIn 0.6s ease-out;
            box-shadow: 0 10px 30px rgba(230, 57, 70, 0.4);
        }

        @keyframes scaleIn {
            0% {
                transform: scale(0);
                opacity: 0;
            }
            50% {
                transform: scale(1.2);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .success-modal h2 {
            font-size: 32px;
            color: #2C3E50;
            margin-bottom: 15px;
            font-weight: 800;
        }

        .success-modal p {
            font-size: 18px;
            color: #6C757D;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .success-modal-close {
            background: linear-gradient(135deg, #E63946 0%, #FF6B6B 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 8px 25px rgba(230, 57, 70, 0.4);
            transition: all 0.3s;
        }

        .success-modal-close:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(230, 57, 70, 0.6);
        }

        /* Modal de Confirma√ß√£o de Logout */
        .confirm-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            z-index: 9999;
            animation: fadeIn 0.3s ease-out;
        }

        .confirm-modal.show {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .confirm-modal-content {
            background: white;
            border-radius: 30px;
            padding: 50px 60px;
            text-align: center;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.4s ease-out;
            position: relative;
        }

        .confirm-icon {
            width: 100px;
            height: 100px;
            margin: 0 auto 30px;
            background: linear-gradient(135deg, #FFC107 0%, #FFD54F 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 50px;
            animation: scaleIn 0.6s ease-out;
            box-shadow: 0 10px 30px rgba(255, 193, 7, 0.4);
        }

        .confirm-modal h2 {
            font-size: 28px;
            color: #2C3E50;
            margin-bottom: 15px;
            font-weight: 800;
        }

        .confirm-modal p {
            font-size: 16px;
            color: #6C757D;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .confirm-modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .confirm-modal-buttons button {
            padding: 15px 35px;
            border: none;
            border-radius: 50px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s;
        }

        .btn-confirm-yes {
            background: linear-gradient(135deg, #E63946 0%, #FF6B6B 100%);
            color: white;
            box-shadow: 0 6px 20px rgba(230, 57, 70, 0.3);
        }

        .btn-confirm-yes:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(230, 57, 70, 0.5);
        }

        .btn-confirm-no {
            background: linear-gradient(135deg, #6C757D 0%, #8B9299 100%);
            color: white;
            box-shadow: 0 6px 20px rgba(108, 117, 125, 0.3);
        }

        .btn-confirm-no:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(108, 117, 125, 0.4);
        }

        /* Feedback System Styles */
        .rating-stars {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }

        .star {
            font-size: 60px;
            cursor: pointer;
            transition: all 0.3s;
            color: #ddd;
            user-select: none;
        }

        .star:hover,
        .star.selected {
            color: #FFD93D;
            transform: scale(1.2);
        }

        .andar-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .andar-btn {
            background: white;
            border: 3px solid #E5E5E5;
            border-radius: 15px;
            padding: 20px;
            font-size: 22px;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            color: #5A5A5A;
        }

        .andar-btn:hover,
        .andar-btn.selected {
            background: linear-gradient(135deg, #E63946 0%, #FF6B6B 100%);
            border-color: #E63946;
            color: white;
            transform: translateY(-5px);
        }

        .warning-box {
            background: #FFF3CD;
            border: 2px solid #FFC107;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .warning-box p {
            color: #856404;
            font-weight: 600;
            font-size: 16px;
            margin: 5px 0;
        }

        /* Detailed Rating Items */
        .detailed-rating-item {
            background: white;
            border: 2px solid #E5E5E5;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .detailed-rating-item:hover {
            border-color: #E63946;
            box-shadow: 0 4px 15px rgba(230, 57, 70, 0.1);
        }

        .detailed-rating-item label {
            display: block;
            font-size: 16px;
            font-weight: 600;
            color: #2C3E50;
            margin-bottom: 12px;
            text-transform: none;
            letter-spacing: 0;
        }

        .mini-rating {
            display: flex;
            gap: 8px;
            justify-content: center;
        }

        .mini-star {
            font-size: 36px;
            cursor: pointer;
            transition: all 0.2s;
            color: #ddd;
            user-select: none;
        }

        .mini-star:hover,
        .mini-star.selected {
            color: #FFD93D;
            transform: scale(1.1);
        }

        .mini-star.selected {
            text-shadow: 0 0 10px rgba(255, 217, 61, 0.5);
        }

        /* Logo Datam√©trica */
        .logo-image {
            width: 80px;
            height: 80px;
            margin: 0 auto 15px;
            background: white;
            border-radius: 15px;
            padding: 10px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-grid {
            display: grid;
            grid-template-columns: repeat(3, 20px);
            grid-template-rows: repeat(3, 20px);
            gap: 2px;
        }

        .logo-cell {
            border-radius: 2px;
        }

        .logo-cell.gray1 { background: #C4C4C4; }
        .logo-cell.gray2 { background: #808080; }
        .logo-cell.red { background: #B73239; }
        .logo-cell.white { background: #E8E8E8; }

        /* Checklist Items */
        .checklist-container {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            padding: 25px;
            border: 2px solid #E5E5E5;
        }

        .checklist-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            margin-bottom: 10px;
            background: white;
            border-radius: 10px;
            border: 2px solid transparent;
            transition: all 0.3s;
            cursor: pointer;
        }

        .checklist-item:hover {
            border-color: #E63946;
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(230, 57, 70, 0.15);
        }

        .checklist-item input[type="checkbox"] {
            width: 24px;
            height: 24px;
            margin-right: 15px;
            cursor: pointer;
            accent-color: #E63946;
        }

        .checklist-item label {
            margin: 0;
            font-size: 16px;
            font-weight: 600;
            color: #5A5A5A;
            cursor: pointer;
            text-transform: none;
            letter-spacing: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checklist-item.checked {
            background: linear-gradient(135deg, rgba(230, 57, 70, 0.05) 0%, rgba(255, 107, 107, 0.05) 100%);
            border-color: #E63946;
        }

        .checklist-item.checked label {
            color: #E63946;
        }

        .item-icon {
            font-size: 20px;
        }

        textarea {
            width: 100%;
            padding: 16px;
            border: 2px solid #E5E5E5;
            border-radius: 12px;
            font-size: 16px;
            font-family: 'Segoe UI', sans-serif;
            resize: vertical;
            min-height: 100px;
            transition: all 0.3s;
        }

        textarea:focus {
            outline: none;
            border-color: #E63946;
            box-shadow: 0 0 0 4px rgba(230, 57, 70, 0.1);
        }

        textarea::placeholder {
            color: #999;
        }

        /* Meta Management */
        .meta-container {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 20px;
            padding: 50px 40px;
            border: 3px solid #E5E5E5;
        }

        .meta-title {
            font-size: 32px;
            font-weight: 800;
            color: #E63946;
            text-align: center;
            margin-bottom: 40px;
            text-transform: uppercase;
            letter-spacing: 3px;
            text-shadow: 2px 2px 4px rgba(230, 57, 70, 0.1);
        }

        .meta-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border-left: 5px solid #E63946;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        .meta-section-title {
            font-size: 18px;
            color: #5A5A5A;
            font-weight: 700;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .meta-field {
            background: linear-gradient(135deg, #E63946 0%, #FF6B6B 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            font-size: 24px;
            font-weight: 700;
            text-align: center;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid transparent;
            box-shadow: 0 6px 20px rgba(230, 57, 70, 0.3);
        }

        .meta-field:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(230, 57, 70, 0.5);
        }

        .meta-field.editable {
            cursor: text;
        }

        .meta-textarea {
            width: 100%;
            background: linear-gradient(135deg, #E63946 0%, #FF6B6B 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            font-size: 24px;
            font-weight: 700;
            text-align: center;
            border: 3px solid #E63946;
            resize: vertical;
            min-height: 80px;
            font-family: 'Segoe UI', sans-serif;
            box-shadow: 0 6px 20px rgba(230, 57, 70, 0.3);
        }

        .meta-textarea::placeholder {
            color: rgba(255,255,255,0.7);
        }

        .meta-textarea:focus {
            outline: none;
            border-color: white;
            box-shadow: 0 0 0 4px rgba(255, 255, 255, 0.3);
        }

        .meta-info {
            background: linear-gradient(135deg, rgba(230, 57, 70, 0.05) 0%, rgba(255, 107, 107, 0.05) 100%);
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            border-left: 5px solid #E63946;
        }

        .meta-info p {
            color: #5A5A5A;
            font-size: 16px;
            margin: 12px 0;
            line-height: 1.6;
        }

        .meta-info strong {
            color: #E63946;
        }

        .bible-verse {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
            text-align: center;
            border: 2px solid #E5E5E5;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        .bible-verse p {
            font-size: 18px;
            font-style: italic;
            color: #5A5A5A;
            line-height: 1.8;
            margin-bottom: 15px;
        }

        .bible-verse cite {
            font-size: 14px;
            color: #E63946;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .meta-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
        }

        .meta-buttons button {
            padding: 15px 40px;
            font-size: 16px;
        }

        /* Gest√£o de Funcion√°rios */
        .employee-management {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
            border-left: 5px solid #E63946;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        .employee-section-title {
            font-size: 20px;
            color: #E63946;
            font-weight: 700;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .upload-area {
            border: 3px dashed #E5E5E5;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            background: #FAFAFA;
            transition: all 0.3s;
            cursor: pointer;
            margin-bottom: 20px;
        }

        .upload-area:hover {
            border-color: #E63946;
            background: rgba(230, 57, 70, 0.05);
        }

        .upload-area.dragover {
            border-color: #E63946;
            background: rgba(230, 57, 70, 0.1);
        }

        .upload-icon {
            font-size: 50px;
            margin-bottom: 15px;
        }

        .upload-text {
            font-size: 16px;
            color: #5A5A5A;
            margin-bottom: 10px;
        }

        .upload-subtext {
            font-size: 13px;
            color: #999;
        }

        .file-input {
            display: none;
        }

        .add-employee-form {
            background: #F8F9FA;
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 2fr 1.5fr auto;
            gap: 15px;
            margin-bottom: 15px;
            align-items: end;
        }

        .employee-list {
            margin-top: 25px;
            max-height: 400px;
            overflow-y: auto;
        }

        .employee-item {
            background: white;
            border-radius: 10px;
            padding: 15px 20px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 2px solid #E5E5E5;
            transition: all 0.3s;
        }

        .employee-item:hover {
            border-color: #E63946;
            transform: translateX(5px);
        }

        .employee-info {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .employee-matricula {
            background: linear-gradient(135deg, #E63946 0%, #FF6B6B 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 14px;
        }

        .employee-nome {
            font-size: 15px;
            font-weight: 600;
            color: #5A5A5A;
        }

        .funcao-badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .funcao-badge.adm {
            background: linear-gradient(135deg, #FFD93D 0%, #FFC700 100%);
            color: #333;
        }

        .funcao-badge.asg {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .funcao-badge.funcionario {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
            color: white;
        }

        .btn-delete-employee {
            background: #dc3545;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 700;
            transition: all 0.3s;
        }

        .btn-delete-employee:hover {
            background: #c82333;
            transform: scale(1.05);
        }

        .btn-edit-employee {
            background: linear-gradient(135deg, #FFD93D 0%, #FFC700 100%);
            color: #2C3E50;
            padding: 8px 16px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 700;
            transition: all 0.3s;
        }

        .btn-edit-employee:hover {
            background: linear-gradient(135deg, #FFC700 0%, #FFB700 100%);
            transform: scale(1.05);
        }

        .employee-count {
            background: linear-gradient(135deg, #E63946 0%, #FF6B6B 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: 700;
        }

        /* Environment Switcher */
        .env-switcher {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
        }

        .btn-switch-env {
            background: linear-gradient(135deg, #6C757D 0%, #8B9299 100%);
            color: white;
            padding: 15px 25px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 700;
            font-size: 14px;
            box-shadow: 0 8px 25px rgba(108, 117, 125, 0.4);
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-switch-env:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(108, 117, 125, 0.6);
        }

        /* Environment Modal */
        .env-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 10000;
        }

        .env-modal.show {
            display: flex;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease-out;
        }

        .env-modal-content {
            background: white;
            border-radius: 30px;
            padding: 50px 60px;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: slideUp 0.4s ease-out;
        }

        .env-modal h2 {
            font-size: 28px;
            color: #2C3E50;
            margin-bottom: 30px;
            font-weight: 800;
        }

        .env-options {
            display: grid;
            gap: 20px;
            margin-top: 30px;
        }

        .env-option {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 3px solid #E5E5E5;
            border-radius: 20px;
            padding: 30px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .env-option:hover {
            border-color: #E63946;
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(230, 57, 70, 0.2);
        }

        .env-option h3 {
            font-size: 22px;
            color: #E63946;
            margin-bottom: 10px;
        }

        .env-option p {
            font-size: 14px;
            color: #6C757D;
        }

        /* Feedback System */
        .feedback-container {
            max-width: 700px;
            margin: 0 auto;
        }

        .rating-container {
            text-align: center;
            margin: 30px 0;
        }

        .rating-stars {
            font-size: 60px;
            margin: 20px 0;
        }

        .star {
            cursor: pointer;
            transition: all 0.3s;
            display: inline-block;
            margin: 0 5px;
        }

        .star:hover {
            transform: scale(1.2);
        }

        .star.selected {
            color: #FFD93D;
            animation: starPulse 0.5s;
        }

        @keyframes starPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.3); }
        }

        .andar-select {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }

        .andar-btn {
            background: white;
            border: 3px solid #E5E5E5;
            border-radius: 15px;
            padding: 20px;
            font-size: 24px;
            font-weight: 800;
            color: #5A5A5A;
            cursor: pointer;
            transition: all 0.3s;
        }

        .andar-btn:hover {
            border-color: #E63946;
            color: #E63946;
            transform: translateY(-5px);
        }

        .andar-btn.selected {
            background: linear-gradient(135deg, #E63946 0%, #FF6B6B 100%);
            border-color: #E63946;
            color: white;
            box-shadow: 0 8px 25px rgba(230, 57, 70, 0.4);
        }

        .area-checkboxes {
            display: grid;
            gap: 15px;
            margin: 30px 0;
        }

        .area-checkbox {
            background: white;
            border: 3px solid #E5E5E5;
            border-radius: 15px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .area-checkbox:hover {
            border-color: #E63946;
            transform: translateX(5px);
        }

        .area-checkbox.selected {
            background: rgba(230, 57, 70, 0.1);
            border-color: #E63946;
        }

        .area-checkbox input[type="checkbox"] {
            width: 30px;
            height: 30px;
            accent-color: #E63946;
        }

        .area-checkbox label {
            font-size: 18px;
            font-weight: 600;
            margin: 0;
            text-transform: none;
            letter-spacing: 0;
        }

        @media (max-width: 768px) {
            .content {
                padding: 25px 20px;
            }

            .header h1 {
                font-size: 24px;
            }

            .tab {
                padding: 15px 10px;
                font-size: 13px;
            }

            .logo-container img {
                max-width: 200px;
            }

            .record-header {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .record-time {
                text-align: left;
            }

            .login-screen {
                padding: 40px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo-container">
                <div class="logo-image">
                    <div style="position:relative;width:180px;height:110px;margin:0 auto;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:15px;background:#FFFFFF;border-radius:15px;box-shadow:0 8px 25px rgba(0,0,0,0.12);padding:20px;">
                        <!-- Letras DTM -->
                        <div style="display:flex;gap:8px;">
                            <div style="font-family:'Arial Black',sans-serif;font-size:48px;font-weight:900;color:#E63946;text-shadow:0 4px 12px rgba(230,57,70,0.4);letter-spacing:3px;line-height:1;">DTM</div>
                        </div>
                        <!-- 3 Quadrados -->
                        <div style="display:flex;gap:10px;">
                            <div style="width:24px;height:24px;background:linear-gradient(135deg, #5A5A5A 0%, #3A3A3A 100%);border-radius:5px;box-shadow:0 4px 8px rgba(0,0,0,0.3);animation:bounce 1.5s ease-in-out infinite;"></div>
                            <div style="width:24px;height:24px;background:linear-gradient(135deg, #E63946 0%, #C41E2A 100%);border-radius:5px;box-shadow:0 4px 8px rgba(230,57,70,0.5);animation:bounce 1.5s ease-in-out infinite;animation-delay:0.2s;"></div>
                            <div style="width:24px;height:24px;background:linear-gradient(135deg, #A0A0A0 0%, #7A7A7A 100%);border-radius:5px;box-shadow:0 4px 8px rgba(0,0,0,0.3);animation:bounce 1.5s ease-in-out infinite;animation-delay:0.4s;"></div>
                        </div>
                        <style>
                            @keyframes bounce {
                                0%, 100% { transform: translateY(0px); }
                                50% { transform: translateY(-10px); }
                            }
                        </style>
                    </div>
                </div>
                <h1 style="margin-top:15px;color:#FFFFFF;text-shadow:0 4px 15px rgba(0,0,0,0.3), 0 2px 8px rgba(230,57,70,0.4);">DATAM√âTRICA</h1>
                <p style="color:#E5E5E5;font-weight:600;text-shadow:0 2px 5px rgba(0,0,0,0.2);">pesquisa e consultoria</p>
            </div>
            <h1 style="margin-top: 25px;">Controle e Qualidade de Limpeza - Praieira</h1>
            <p>
                <span id="statusIndicator"></span>
                Sistema de Qualidade Interna
            </p>
        </div>

        <!-- Tela de Login -->
        <div id="loginScreen" class="login-screen">
            <h2>üîê Acesso ao Sistema</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label for="matricula">Matr√≠cula *</label>
                    <input type="text" id="matricula" required placeholder="Digite sua matr√≠cula" autocomplete="off">
                </div>

                <div class="form-group">
                    <label for="senha">Senha *</label>
                    <input type="password" id="senha" required placeholder="Digite a senha">
                </div>

                <button type="submit" class="btn-primary">üîì Entrar</button>
                
                <div style="margin-top:20px;">
                    <button type="button" onclick="showQuickFeedback()" class="btn-secondary" style="width:100%;background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);color:white;border:none;">
                        ‚≠ê Enviar Avalia√ß√£o R√°pida
                    </button>
                </div>
                
                <div style="text-align:center;margin-top:20px;">
                    <a href="#" onclick="showForgotPasswordModal(); return false;" style="color:#E63946;text-decoration:none;font-size:14px;font-weight:600;">
                        üîí Esqueci minha senha
                    </a>
                </div>
            </form>
        </div>

        <!-- Tela de Avalia√ß√£o R√°pida -->
        <div id="quickFeedbackScreen" class="login-screen" style="display:none;max-width:600px;">
            <div style="position:relative;">
                <button onclick="hideQuickFeedback()" style="position:absolute;left:0;top:0;background:transparent;border:none;color:#999;font-size:14px;cursor:pointer;padding:5px 10px;">
                    ‚Üê Voltar
                </button>
                <h2 style="text-align:center;">‚≠ê Avalia√ß√£o R√°pida</h2>
            </div>
            
            <form id="quickFeedbackForm" style="margin-top:20px;">
                <!-- Escolha do Andar -->
                <div class="form-group">
                    <label>üìç Escolha o andar: *</label>
                    <select id="qf_andar" required style="width:100%;padding:12px;border:2px solid #E5E5E5;border-radius:12px;font-size:16px;">
                        <option value="">Selecione o andar</option>
                        <option value="T√©rreo">T√©rreo</option>
                        <option value="1¬∫">1¬∫ Andar</option>
                        <option value="2¬∫">2¬∫ Andar</option>
                        <option value="3¬∫">3¬∫ Andar</option>
                        <option value="4¬∫">4¬∫ Andar</option>
                        <option value="5¬∫">5¬∫ Andar</option>
                    </select>
                </div>

                <!-- Avalia√ß√£o do Banheiro -->
                <div style="background:#F8F9FA;padding:20px;border-radius:12px;margin-bottom:20px;">
                    <h3 style="margin:0 0 15px 0;color:#2C3E50;font-size:18px;">üöª Como voc√™ avalia o banheiro?</h3>
                    
                    <div style="margin-bottom:15px;">
                        <label style="display:block;margin-bottom:8px;font-weight:600;">Tipo: *</label>
                        <div style="display:flex;gap:20px;">
                            <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
                                <input type="radio" name="qf_banheiro_tipo" value="Masculino" required>
                                <span>Masculino</span>
                            </label>
                            <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
                                <input type="radio" name="qf_banheiro_tipo" value="Feminino">
                                <span>Feminino</span>
                            </label>
                        </div>
                    </div>

                    <div>
                        <label style="display:block;margin-bottom:10px;font-weight:600;">Avalia√ß√£o:</label>
                        <div class="slider-container">
                            <input type="range" id="qf_banheiro" min="0" max="5" step="0.1" value="0" class="color-slider" oninput="updateSliderValue('qf_banheiro')">
                            <div style="display:flex;justify-content:space-between;font-size:12px;color:#666;margin-top:5px;">
                                <span>üî¥ Ruim</span>
                                <span>üü° Regular</span>
                                <span>üü¢ Bom</span>
                            </div>
                            <div style="text-align:center;margin-top:10px;font-size:18px;font-weight:bold;color:#2C3E50;">
                                Nota: <span id="qf_banheiro_value">0.0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Avalia√ß√£o da Copa -->
                <div style="background:#F8F9FA;padding:20px;border-radius:12px;margin-bottom:20px;">
                    <h3 style="margin:0 0 15px 0;color:#2C3E50;font-size:18px;">‚òï Como voc√™ avalia a Copa?</h3>
                    <div>
                        <label style="display:block;margin-bottom:10px;font-weight:600;">Avalia√ß√£o:</label>
                        <div class="slider-container">
                            <input type="range" id="qf_copa" min="0" max="5" step="0.1" value="0" class="color-slider" oninput="updateSliderValue('qf_copa')">
                            <div style="display:flex;justify-content:space-between;font-size:12px;color:#666;margin-top:5px;">
                                <span>üî¥ Ruim</span>
                                <span>üü° Regular</span>
                                <span>üü¢ Bom</span>
                            </div>
                            <div style="text-align:center;margin-top:10px;font-size:18px;font-weight:bold;color:#2C3E50;">
                                Nota: <span id="qf_copa_value">0.0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Avalia√ß√£o da √Årea de Relax -->
                <div style="background:#F8F9FA;padding:20px;border-radius:12px;margin-bottom:20px;">
                    <h3 style="margin:0 0 15px 0;color:#2C3E50;font-size:18px;">üõãÔ∏è Como voc√™ avalia a √°rea de descanso?</h3>
                    <div>
                        <label style="display:block;margin-bottom:10px;font-weight:600;">Avalia√ß√£o:</label>
                        <div class="slider-container">
                            <input type="range" id="qf_relax" min="0" max="5" step="0.1" value="0" class="color-slider" oninput="updateSliderValue('qf_relax')">
                            <div style="display:flex;justify-content:space-between;font-size:12px;color:#666;margin-top:5px;">
                                <span>üî¥ Ruim</span>
                                <span>üü° Regular</span>
                                <span>üü¢ Bom</span>
                            </div>
                            <div style="text-align:center;margin-top:10px;font-size:18px;font-weight:bold;color:#2C3E50;">
                                Nota: <span id="qf_relax_value">0.0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Coment√°rios -->
                <div class="form-group">
                    <label>üí¨ Coment√°rios (opcional):</label>
                    <textarea id="qf_comentarios" rows="3" placeholder="Sugest√µes, elogios, cr√≠ticas ou melhorias..." style="width:100%;padding:12px;border:2px solid #E5E5E5;border-radius:12px;font-size:14px;font-family:inherit;resize:vertical;"></textarea>
                </div>

                <!-- Identifica√ß√£o (opcional) -->
                <div class="form-group">
                    <label>üë§ Seu nome (opcional):</label>
                    <input type="text" id="qf_identificacao" placeholder="Digite seu nome se quiser se identificar" style="width:100%;padding:12px;border:2px solid #E5E5E5;border-radius:12px;font-size:16px;">
                </div>

                <button type="submit" class="btn-primary" style="width:100%;font-size:18px;padding:15px;">
                    üì§ Enviar Avalia√ß√£o
                </button>
            </form>
        </div>

        <!-- Informa√ß√£o do Usu√°rio Logado -->
        <div id="userInfo" class="user-info hidden">
            <div class="user-name">
                Logado como: <span id="loggedUserName"></span>
                <span id="adminBadge" class="admin-badge" style="display:none;">ADM</span>
            </div>
            <div style="display:flex;gap:10px;align-items:center;">
                <button class="btn-change-password" onclick="showChangePasswordModal()">üîë Alterar Senha</button>
                <button class="btn-logout" onclick="confirmLogout()">Sair</button>
            </div>
        </div>

        <div class="config-banner" id="configBanner">
            <button class="config-banner-close" onclick="hideConfigBanner()">√ó</button>
            <h3>‚öôÔ∏è Configura√ß√£o do Sistema</h3>
            <p style="margin-bottom:20px;">Configure as URLs dos Google Apps Scripts para cada planilha:</p>
            
            <div style="margin-bottom:25px;">
                <label style="display:block;font-weight:600;margin-bottom:8px;color:#E63946;">üßπ URL Google Script - Limpeza:</label>
                <input type="text" id="scriptUrlLimpeza" placeholder="https://script.google.com/macros/s/..." style="margin-bottom:5px;">
                <small style="color:#666;display:block;">Para registros de limpeza (ASG)</small>
            </div>
            
            <div style="margin-bottom:25px;">
                <label style="display:block;font-weight:600;margin-bottom:8px;color:#E63946;">üí≠ URL Google Script - Feedback:</label>
                <input type="text" id="scriptUrlFeedback" placeholder="https://script.google.com/macros/s/..." style="margin-bottom:5px;">
                <small style="color:#666;display:block;">Para feedbacks dos usu√°rios</small>
            </div>
            
            <button onclick="saveScriptUrls()">üíæ Salvar Configura√ß√£o</button>
        </div>

        <div id="mainApp" class="hidden">
            <div class="tabs">
                <button class="tab active" onclick="showTab('novo')">üìù Novo Registro</button>
                <button class="tab" id="tabHistorico" onclick="showTab('historico')" style="display:none;">üìä Hist√≥rico</button>
                <button class="tab" id="tabAnalise" onclick="showTab('analise')" style="display:none;">ü§ñ An√°lise IA</button>
                <button class="tab" onclick="showTab('meta')">üéØ Meta</button>
                <button class="tab" id="tabFuncionarios" onclick="showTab('funcionarios')" style="display:none;">üë• Funcion√°rios</button>
                <button class="tab" id="tabSolicitacoes" onclick="showTab('solicitacoes')" style="display:none;">üîî Solicita√ß√µes</button>
            </div>

            <div class="content">
                <!-- Aba: Novo Registro -->
                <div id="novo" class="tab-content active">
                    <form id="checklistForm">
                        <div class="form-group">
                            <label for="nome">Nome do Funcion√°rio</label>
                            <input type="text" id="nome" required readonly>
                        </div>

                        <div class="form-group">
                            <label for="local">Local do Banheiro *</label>
                            <select id="local" required>
                                <option value="">Selecione o local</option>
                                <option value="Banheiro Masculino T√©rreo">Banheiro Masculino T√©rreo</option>
                                <option value="Banheiro Feminino T√©rreo">Banheiro Feminino T√©rreo</option>
                                <option value="Banheiro Masculino 1¬∫ Andar">Banheiro Masculino 1¬∫ Andar</option>
                                <option value="Banheiro Feminino 1¬∫ Andar">Banheiro Feminino 1¬∫ Andar</option>
                                <option value="Banheiro Masculino 2¬∫ Andar">Banheiro Masculino 2¬∫ Andar</option>
                                <option value="Banheiro Feminino 2¬∫ Andar">Banheiro Feminino 2¬∫ Andar</option>
                                <option value="Banheiro Masculino 3¬∫ Andar">Banheiro Masculino 3¬∫ Andar</option>
                                <option value="Banheiro Feminino 3¬∫ Andar">Banheiro Feminino 3¬∫ Andar</option>
                                <option value="Banheiro Masculino 4¬∫ Andar">Banheiro Masculino 4¬∫ Andar</option>
                                <option value="Banheiro Feminino 4¬∫ Andar">Banheiro Feminino 4¬∫ Andar</option>
                                <option value="Banheiro Masculino 5¬∫ Andar">Banheiro Masculino 5¬∫ Andar</option>
                                <option value="Banheiro Feminino 5¬∫ Andar">Banheiro Feminino 5¬∫ Andar</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Foto do Funcion√°rio *</label>
                            <div class="camera-container">
                                <video id="video" autoplay playsinline></video>
                                <img id="preview" alt="Preview">
                            </div>
                            <div class="camera-buttons">
                                <button type="button" class="btn-secondary" onclick="startCamera()">üì∑ Abrir C√¢mera</button>
                                <button type="button" class="btn-primary" id="captureBtn" onclick="capturePhoto()" style="display:none;">üì∏ Capturar</button>
                                <button type="button" class="btn-secondary" id="retakeBtn" onclick="retakePhoto()" style="display:none;">üîÑ Nova Foto</button>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Checklist de Limpeza *</label>
                            <div class="checklist-container">
                                <div class="checklist-item" onclick="toggleCheckbox('item1')">
                                    <input type="checkbox" id="item1" onclick="event.stopPropagation()">
                                    <label for="item1">
                                        <span class="item-icon">üöΩ</span>
                                        Vaso sanit√°rio limpo e higienizado
                                    </label>
                                </div>
                                <div class="checklist-item" onclick="toggleCheckbox('item2')">
                                    <input type="checkbox" id="item2" onclick="event.stopPropagation()">
                                    <label for="item2">
                                        <span class="item-icon">üö∞</span>
                                        Pia e torneira higienizadas
                                    </label>
                                </div>
                                <div class="checklist-item" onclick="toggleCheckbox('item3')">
                                    <input type="checkbox" id="item3" onclick="event.stopPropagation()">
                                    <label for="item3">
                                        <span class="item-icon">ü™û</span>
                                        Espelho limpo
                                    </label>
                                </div>
                                <div class="checklist-item" onclick="toggleCheckbox('item4')">
                                    <input type="checkbox" id="item4" onclick="event.stopPropagation()">
                                    <label for="item4">
                                        <span class="item-icon">üóëÔ∏è</span>
                                        Lixeira esvaziada
                                    </label>
                                </div>
                                <div class="checklist-item" onclick="toggleCheckbox('item5')">
                                    <input type="checkbox" id="item5" onclick="event.stopPropagation()">
                                    <label for="item5">
                                        <span class="item-icon">üßª</span>
                                        Papel higi√™nico reposto
                                    </label>
                                </div>
                                <div class="checklist-item" onclick="toggleCheckbox('item6')">
                                    <input type="checkbox" id="item6" onclick="event.stopPropagation()">
                                    <label for="item6">
                                        <span class="item-icon">üßº</span>
                                        Sabonete/Sab√£o verificado
                                    </label>
                                </div>
                                <div class="checklist-item" onclick="toggleCheckbox('item7')">
                                    <input type="checkbox" id="item7" onclick="event.stopPropagation()">
                                    <label for="item7">
                                        <span class="item-icon">üßπ</span>
                                        Ch√£o lavado e seco
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="observacoes">Observa√ß√µes (Opcional)</label>
                            <textarea id="observacoes" placeholder="Ex: Sabonete acabou, torneira pingando, etc..."></textarea>
                        </div>

                        <div class="loading" id="submitLoading">
                            <div class="spinner"></div>
                            <p><strong>Enviando para Google Sheets...</strong></p>
                        </div>

                        <button type="submit" class="btn-success" id="submitBtn">‚úÖ Finalizar Limpeza</button>
                    </form>
                </div>

                <!-- Aba: Hist√≥rico -->
                <div id="historico" class="tab-content">
                    <div class="meta-container">
                        <div class="meta-title">üìä HIST√ìRICO</div>
                        
                        <!-- Seletor de Tipo de Hist√≥rico -->
                        <div style="display:flex;gap:15px;justify-content:center;margin-bottom:30px;">
                            <button class="andar-btn selected" id="btnHistoricoLimpeza" onclick="showHistoricoLimpeza()" style="flex:1;max-width:250px;">
                                üßπ Registros de Limpeza
                            </button>
                            <button class="andar-btn" id="btnHistoricoFeedback" onclick="showHistoricoFeedback()" style="flex:1;max-width:250px;">
                                üí≠ Feedbacks Recebidos
                            </button>
                        </div>

                        <!-- FILTROS AVAN√áADOS -->
                        <div style="background:white;padding:25px;border-radius:15px;margin-bottom:25px;box-shadow:0 4px 15px rgba(0,0,0,0.1);">
                            <h3 style="margin:0 0 20px 0;color:#E63946;display:flex;align-items:center;gap:10px;">
                                üîç Filtros Avan√ßados
                            </h3>
                            <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;">
                                <!-- Per√≠odo -->
                                <div>
                                    <label style="display:block;font-weight:600;margin-bottom:8px;color:#2C3E50;">üìÖ Per√≠odo:</label>
                                    <select id="filtroPeriodo" onchange="aplicarFiltros()" style="width:100%;padding:10px;border:2px solid #E5E5E5;border-radius:8px;">
                                        <option value="todos">Todos os per√≠odos</option>
                                        <option value="hoje">Hoje</option>
                                        <option value="semana">√öltima semana</option>
                                        <option value="mes">√öltimo m√™s</option>
                                        <option value="custom">Per√≠odo customizado</option>
                                    </select>
                                </div>
                                
                                <!-- Funcion√°rio -->
                                <div>
                                    <label style="display:block;font-weight:600;margin-bottom:8px;color:#2C3E50;">üë§ Funcion√°rio:</label>
                                    <select id="filtroFuncionario" onchange="aplicarFiltros()" style="width:100%;padding:10px;border:2px solid #E5E5E5;border-radius:8px;">
                                        <option value="todos">Todos</option>
                                    </select>
                                </div>
                                
                                <!-- Andar -->
                                <div>
                                    <label style="display:block;font-weight:600;margin-bottom:8px;color:#2C3E50;">üè¢ Andar:</label>
                                    <select id="filtroAndar" onchange="aplicarFiltros()" style="width:100%;padding:10px;border:2px solid #E5E5E5;border-radius:8px;">
                                        <option value="todos">Todos os andares</option>
                                        <option value="T√©rreo">T√©rreo</option>
                                        <option value="1¬∫">1¬∫ Andar</option>
                                        <option value="2¬∫">2¬∫ Andar</option>
                                        <option value="3¬∫">3¬∫ Andar</option>
                                        <option value="4¬∫">4¬∫ Andar</option>
                                        <option value="5¬∫">5¬∫ Andar</option>
                                    </select>
                                </div>

                                <!-- Avalia√ß√£o (s√≥ para feedbacks) -->
                                <div id="filtroAvaliacaoDiv" style="display:none;">
                                    <label style="display:block;font-weight:600;margin-bottom:8px;color:#2C3E50;">‚≠ê Avalia√ß√£o:</label>
                                    <select id="filtroAvaliacao" onchange="aplicarFiltros()" style="width:100%;padding:10px;border:2px solid #E5E5E5;border-radius:8px;">
                                        <option value="todos">Todas</option>
                                        <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (5 estrelas)</option>
                                        <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê (4 estrelas)</option>
                                        <option value="3">‚≠ê‚≠ê‚≠ê (3 estrelas)</option>
                                        <option value="baixo">‚≠ê‚≠ê ou menos (cr√≠tico)</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Datas customizadas -->
                            <div id="datasCustomizadas" style="display:none;margin-top:15px;display:grid;grid-template-columns:1fr 1fr auto;gap:10px;align-items:end;">
                                <div>
                                    <label style="display:block;font-weight:600;margin-bottom:8px;color:#2C3E50;">De:</label>
                                    <input type="date" id="dataInicio" style="width:100%;padding:10px;border:2px solid #E5E5E5;border-radius:8px;">
                                </div>
                                <div>
                                    <label style="display:block;font-weight:600;margin-bottom:8px;color:#2C3E50;">At√©:</label>
                                    <input type="date" id="dataFim" style="width:100%;padding:10px;border:2px solid #E5E5E5;border-radius:8px;">
                                </div>
                                <button onclick="aplicarFiltros()" class="btn-primary" style="padding:10px 20px;">Aplicar</button>
                            </div>

                            <!-- Bot√£o limpar filtros -->
                            <div style="margin-top:15px;text-align:right;">
                                <button onclick="limparFiltros()" style="background:#6B7280;color:white;border:none;padding:10px 20px;border-radius:8px;cursor:pointer;font-weight:600;">
                                    üîÑ Limpar Filtros
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stats" id="stats"></div>
                    <div class="loading" id="historyLoading">
                        <div class="spinner"></div>
                        <p><strong>Carregando registros...</strong></p>
                    </div>
                    <div class="records-list" id="recordsList"></div>
                </div>

                <!-- Aba: An√°lise IA -->
                <div id="analise" class="tab-content">
                    <div class="meta-container">
                        <div class="meta-title">ü§ñ AN√ÅLISE INTELIGENTE COM IA</div>
                        
                        <div style="background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);padding:25px;border-radius:15px;margin-bottom:25px;color:white;">
                            <h3 style="margin:0 0 10px 0;font-size:18px;">üí° An√°lise Autom√°tica de Dados</h3>
                            <p style="margin:0;opacity:0.9;">A IA analisa todos os registros de limpeza e feedbacks para identificar padr√µes, tend√™ncias e sugest√µes de melhoria.</p>
                        </div>

                        <button class="btn-primary" onclick="gerarAnaliseIA()" style="width:100%;margin-bottom:30px;font-size:18px;padding:18px;">
                            üîç Gerar An√°lise Inteligente
                        </button>

                        <div id="analiseLoading" style="display:none;text-align:center;padding:40px;">
                            <div class="spinner"></div>
                            <p style="margin-top:20px;font-size:16px;color:#666;">ü§ñ IA analisando dados...</p>
                        </div>

                        <div id="analiseResults" style="display:none;">
                            <!-- Tend√™ncias Gerais -->
                            <div style="background:white;border-radius:15px;padding:25px;margin-bottom:20px;box-shadow:0 4px 15px rgba(0,0,0,0.1);">
                                <h3 style="color:#E63946;margin:0 0 15px 0;display:flex;align-items:center;gap:10px;">
                                    üìà Tend√™ncias Identificadas
                                </h3>
                                <div id="tendencias"></div>
                            </div>

                            <!-- Problemas Recorrentes -->
                            <div style="background:white;border-radius:15px;padding:25px;margin-bottom:20px;box-shadow:0 4px 15px rgba(0,0,0,0.1);">
                                <h3 style="color:#E63946;margin:0 0 15px 0;display:flex;align-items:center;gap:10px;">
                                    ‚ö†Ô∏è Problemas Recorrentes
                                </h3>
                                <div id="problemas"></div>
                            </div>

                            <!-- Sugest√µes de Melhoria -->
                            <div style="background:white;border-radius:15px;padding:25px;margin-bottom:20px;box-shadow:0 4px 15px rgba(0,0,0,0.1);">
                                <h3 style="color:#E63946;margin:0 0 15px 0;display:flex;align-items:center;gap:10px;">
                                    üí° Sugest√µes de Melhoria
                                </h3>
                                <div id="sugestoes"></div>
                            </div>

                            <!-- Estat√≠sticas -->
                            <div style="background:white;border-radius:15px;padding:25px;box-shadow:0 4px 15px rgba(0,0,0,0.1);">
                                <h3 style="color:#E63946;margin:0 0 15px 0;display:flex;align-items:center;gap:10px;">
                                    üìä Estat√≠sticas Detalhadas
                                </h3>
                                <div id="estatisticas"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Aba: Meta -->
                <div id="meta" class="tab-content">
                    <div class="meta-container">
                        <div class="meta-title">üéØ META DISPON√çVEL</div>

                        <div class="meta-section">
                            <div class="meta-section-title">üìã Qual √© a Meta?</div>
                            <textarea id="metaDescricao" class="meta-textarea" placeholder="Ex: Realizar 50 limpezas por dia" readonly></textarea>
                        </div>

                        <div class="meta-section">
                            <div class="meta-section-title">üèÜ Premia√ß√£o</div>
                            <textarea id="metaPremiacao" class="meta-textarea" placeholder="Ex: R$ 100 de b√¥nus para quem atingir a meta" readonly></textarea>
                        </div>

                        <div class="meta-buttons" id="metaButtons" style="display:none;">
                            <button class="btn-primary" onclick="saveMeta()">üíæ Salvar Meta</button>
                            <button class="btn-secondary" onclick="cancelEditMeta()">‚ùå Cancelar</button>
                        </div>

                        <div class="meta-info">
                            <p id="infoFuncionario">
                                <strong>üí™ Mensagem Motivacional:</strong><br>
                                "O sucesso √© a soma de pequenos esfor√ßos repetidos dia ap√≥s dia. Cada limpeza que voc√™ realiza faz a diferen√ßa e contribui para um ambiente melhor para todos. Continue firme, voc√™ √© essencial!"
                            </p>
                            <p id="infoAdmin" style="display:none;">
                                <strong>üîê Informa√ß√£o Administrativa:</strong><br>
                                Voc√™ tem permiss√£o para editar a meta e a premia√ß√£o. Clique nos campos acima para modificar as informa√ß√µes.
                            </p>
                        </div>

                        <!-- RANKING DE DESEMPENHO -->
                        <div style="margin-top:40px;" id="rankingSection">
                            <div class="meta-title">üèÜ RANKING DE DESEMPENHO</div>
                            <div style="background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);padding:20px;border-radius:15px;margin-bottom:20px;color:white;">
                                <h3 style="margin:0 0 10px 0;font-size:16px;">üìä Sistema de Pontos</h3>
                                <div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;font-size:14px;opacity:0.95;">
                                    <div>‚≠ê <strong>10 pontos</strong> por limpeza registrada</div>
                                    <div>üåü <strong>50 pontos</strong> por feedback 5 estrelas</div>
                                </div>
                            </div>
                            <div id="rankingContainer"></div>
                        </div>

                        <div class="bible-verse">
                            <p>"At√© aqui nos ajudou o Senhor."</p>
                            <cite>‚Äî 1 Samuel 7:12</cite>
                        </div>
                    </div>
                </div>

                <!-- Aba: Funcion√°rios -->
                <div id="funcionarios" class="tab-content">
                    <div class="meta-container">
                        <div class="meta-title">üë• GEST√ÉO DE FUNCION√ÅRIOS</div>

                        <div class="employee-count" id="employeeCount">
                            Total de Funcion√°rios: 0
                        </div>

                        <div class="employee-management">
                            <div class="employee-section-title">üì§ Upload de Lista</div>
                            <div class="upload-area" onclick="document.getElementById('fileInput').click()" 
                                 ondragover="handleDragOver(event)" 
                                 ondrop="handleDrop(event)"
                                 ondragleave="handleDragLeave(event)">
                                <div class="upload-icon">üìÑ</div>
                                <div class="upload-text">Clique ou arraste um arquivo CSV</div>
                                <div class="upload-subtext">Formato: MATRICULA,NOME COMPLETO,FUNCAO</div>
                                <div class="upload-subtext" style="font-size:11px;margin-top:5px;">Fun√ß√£o: ASG ou Funcion√°rio</div>
                            </div>
                            <input type="file" id="fileInput" class="file-input" accept=".csv,.xlsx,.xls,.txt" onchange="handleFileSelect(event)">
                        </div>

                        <div class="employee-management">
                            <div class="employee-section-title">‚ûï Adicionar Funcion√°rio Individual</div>
                            <div class="add-employee-form">
                                <div class="form-row">
                                    <div class="form-group" style="margin:0;">
                                        <label>Matr√≠cula</label>
                                        <input type="text" id="newMatricula" placeholder="Ex: 12345">
                                    </div>
                                    <div class="form-group" style="margin:0;">
                                        <label>Nome Completo</label>
                                        <input type="text" id="newNome" placeholder="Ex: JO√ÉO DA SILVA">
                                    </div>
                                    <div class="form-group" style="margin:0;">
                                        <label>Fun√ß√£o</label>
                                        <select id="newFuncao">
                                            <option value="">Selecione a fun√ß√£o</option>
                                            <option value="ADM">üëî Administrador (ADM)</option>
                                            <option value="ASG">üßπ Auxiliar de Servi√ßos Gerais (ASG)</option>
                                        </select>
                                    </div>
                                    <button class="btn-primary" onclick="addEmployee()">‚ûï Adicionar</button>
                                </div>
                            </div>
                        </div>

                        <div class="employee-management">
                            <div class="employee-section-title">üìã Lista de Funcion√°rios</div>
                            <div style="margin-bottom:20px;">
                                <input type="text" id="searchEmployee" placeholder="üîç Buscar por matr√≠cula ou nome..." style="width:100%;padding:15px;border:2px solid #E5E5E5;border-radius:12px;font-size:16px;" oninput="filterEmployees()">
                            </div>
                            <div class="employee-list" id="employeeList"></div>
                        </div>
                    </div>
                </div>

                <!-- Aba: Solicita√ß√µes -->
                <div id="solicitacoes" class="tab-content">
                    <div class="meta-container">
                        <div class="meta-title">üîî SOLICITA√á√ïES DE RESET DE SENHA</div>

                        <div class="employee-count" id="requestsCount">
                            Solicita√ß√µes Pendentes: 0
                        </div>

                        <div class="employee-management">
                            <div class="employee-list" id="requestsList"></div>
                        </div>

                        <div class="meta-info" style="margin-top:30px;">
                            <p><strong>‚ÑπÔ∏è Como funciona:</strong></p>
                            <p>Quando um funcion√°rio esquece sua senha, ele pode solicitar o reset.</p>
                            <p>Ao clicar em "Resetar Senha", a senha voltar√° para: <strong>datametrica2026</strong></p>
                        </div>

                        <!-- Reset de Limite de Feedback -->
                        <div style="margin-top:40px;padding:25px;background:linear-gradient(135deg, #FFD93D 0%, #FFC700 100%);border-radius:15px;">
                            <div style="font-size:20px;font-weight:800;color:#2C3E50;margin-bottom:15px;">
                                üîÑ RESETAR LIMITE DE FEEDBACK
                            </div>
                            <p style="color:#5A5A5A;margin-bottom:20px;font-size:15px;">
                                Use esta fun√ß√£o para permitir que um funcion√°rio envie novamente feedback no mesmo m√™s.
                            </p>
                            <div style="display:flex;gap:10px;align-items:center;">
                                <input type="text" id="matriculaResetFeedback" placeholder="Digite a matr√≠cula" style="flex:1;padding:15px;border:2px solid #E5E5E5;border-radius:12px;font-size:16px;">
                                <button onclick="resetarLimiteFeedback()" style="padding:15px 30px;background:#E63946;color:white;border:none;border-radius:12px;font-weight:700;cursor:pointer;white-space:nowrap;">
                                    üîì Resetar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            ¬© 2025 Datam√©trica - Pesquisa e Consultoria | Controle e Qualidade de Limpeza - Praieira
            <a class="settings-link" id="settingsLink" onclick="showConfigBanner()" style="display:none;">‚öôÔ∏è Configura√ß√µes</a>
        </div>
    </div>

    <!-- Modal de Sucesso -->
    <div id="successModal" class="success-modal">
        <div class="success-modal-content">
            <div class="success-icon">‚úì</div>
            <h2>Limpeza Registrada!</h2>
            <p>O registro foi salvo com sucesso no Google Sheets.</p>
            <button class="success-modal-close" onclick="closeSuccessModal()">OK, Entendi</button>
        </div>
    </div>

    <!-- Modal de Confirma√ß√£o de Logout -->
    <div id="confirmModal" class="confirm-modal">
        <div class="confirm-modal-content">
            <div class="confirm-icon">‚ö†Ô∏è</div>
            <h2>Confirmar Sa√≠da</h2>
            <p>Voc√™ realmente deseja sair da sua conta?</p>
            <div class="confirm-modal-buttons">
                <button class="btn-confirm-yes" onclick="confirmLogoutYes()">Sim, Sair</button>
                <button class="btn-confirm-no" onclick="confirmLogoutNo()">N√£o, Ficar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Alterar Senha -->
    <div id="changePasswordModal" class="confirm-modal">
        <div class="confirm-modal-content">
            <div class="confirm-icon" style="background:linear-gradient(135deg, #FFD93D 0%, #FFC700 100%);">üîë</div>
            <h2>Alterar Senha</h2>
            <form id="changePasswordForm" style="text-align:left;margin-top:20px;">
                <div class="form-group">
                    <label>Senha Atual</label>
                    <input type="password" id="currentPassword" required placeholder="Digite sua senha atual">
                </div>
                <div class="form-group">
                    <label>Nova Senha</label>
                    <input type="password" id="newPassword" required placeholder="M√≠nimo 6 caracteres">
                </div>
                <div class="form-group">
                    <label>Confirmar Nova Senha</label>
                    <input type="password" id="confirmNewPassword" required placeholder="Digite novamente">
                </div>
                <div class="confirm-modal-buttons">
                    <button type="submit" class="btn-confirm-yes">üíæ Salvar</button>
                    <button type="button" class="btn-confirm-no" onclick="closeChangePasswordModal()">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Esqueci Minha Senha -->
    <div id="forgotPasswordModal" class="confirm-modal">
        <div class="confirm-modal-content">
            <div class="confirm-icon" style="background:linear-gradient(135deg, #E63946 0%, #FF6B6B 100%);">üîí</div>
            <h2>Esqueci Minha Senha</h2>
            <p style="margin:20px 0;">Digite sua matr√≠cula para solicitar a redefini√ß√£o de senha aos administradores.</p>
            <form id="forgotPasswordForm" style="text-align:left;">
                <div class="form-group">
                    <label>Matr√≠cula</label>
                    <input type="text" id="forgotMatricula" required placeholder="Digite sua matr√≠cula">
                </div>
                <div class="confirm-modal-buttons">
                    <button type="submit" class="btn-confirm-yes">üì§ Enviar Solicita√ß√£o</button>
                    <button type="button" class="btn-confirm-no" onclick="closeForgotPasswordModal()">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Aviso (z-index mais alto para ficar sempre na frente) -->
    <div id="warningModal" class="confirm-modal" style="z-index:99999;">
        <div class="confirm-modal-content" style="animation: bounceIn 0.5s ease-out;">
            <div class="confirm-icon" id="warningIcon">‚ö†Ô∏è</div>
            <h2 id="warningTitle">Aten√ß√£o</h2>
            <p id="warningMessage">Mensagem aqui</p>
            <div class="confirm-modal-buttons">
                <button class="btn-confirm-yes" onclick="closeWarningModal()">OK, Entendi</button>
            </div>
        </div>
    </div>

    <script>
        // Base de dados de funcion√°rios - carregada do localStorage
        let FUNCIONARIOS = {};
        
        // Carregar funcion√°rios do localStorage ao iniciar
        function loadFuncionarios() {
            const stored = localStorage.getItem('funcionarios');
            if (stored) {
                FUNCIONARIOS = JSON.parse(stored);
            } else {
                // Inicializar com admins apenas
                FUNCIONARIOS = {
                    '41418': { 
                        nome: 'HENRIQUE THOMPSON DE BRITO LINS', 
                        funcao: 'ADM',
                        senha: 'datametrica2026',
                        senhaAlterada: false
                    },
                    '36312': { 
                        nome: 'JEFFERSON GRACEZ', 
                        funcao: 'ADM',
                        senha: 'datametrica2026',
                        senhaAlterada: false
                    }
                };
                saveFuncionarios();
            }
        }

        function saveFuncionarios() {
            localStorage.setItem('funcionarios', JSON.stringify(FUNCIONARIOS));
        }

        // Solicita√ß√µes de reset de senha
        function loadResetRequests() {
            return JSON.parse(localStorage.getItem('resetRequests') || '[]');
        }

        function saveResetRequests(requests) {
            localStorage.setItem('resetRequests', JSON.stringify(requests));
        }

        const SENHA_PADRAO = 'datametrica2026';
        
        // Administradores que podem editar tudo
        const ADMINS = ['41418', '36312'];

        // Vari√°veis globais
        let stream = null;
        let photoData = null;
        let SCRIPT_URL_LIMPEZA = 'https://script.google.com/macros/s/AKfycbx3c6MJQLJqkBYwjnJPM_sZiIkNCSclAcAhT9R4-RpuycV_Z2Z5Vi2g_y_Wtv_3tA9gAg/exec';
        let SCRIPT_URL_FEEDBACK = 'https://script.google.com/macros/s/AKfycbyLYMmhqXaSMauM_ewzJwHyOxzbtZJ9WZqxsAe4D3HcNlQEVUvm6aXLXcf9NoKS10ZUYA/exec';
        let currentUser = null;

        // Inicializar
        window.onload = function() {
            loadFuncionarios();
            checkConfiguration();
        };

        // Login
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const matricula = document.getElementById('matricula').value.trim();
            const senha = document.getElementById('senha').value;
            
            // Validar matr√≠cula
            if (!FUNCIONARIOS[matricula]) {
                showInfoModal('‚ùå Matr√≠cula N√£o Encontrada', 'A matr√≠cula informada n√£o est√° cadastrada no sistema. Verifique e tente novamente.');
                return;
            }
            
            // Validar senha (customizada ou padr√£o)
            const senhaCorreta = FUNCIONARIOS[matricula].senha || SENHA_PADRAO;
            if (senha !== senhaCorreta) {
                showInfoModal('‚ùå Senha Incorreta', 'A senha informada est√° incorreta. Tente novamente ou clique em "Esqueci minha senha".');
                return;
            }
            
            // Login bem-sucedido
            currentUser = {
                matricula: matricula,
                nome: FUNCIONARIOS[matricula].nome,
                funcao: FUNCIONARIOS[matricula].funcao,
                senhaAlterada: FUNCIONARIOS[matricula].senhaAlterada || false
            };
            
            // Verificar fun√ß√£o e mostrar abas corretas
            const isAdmin = ADMINS.includes(matricula);
            const funcao = currentUser.funcao;
            
            // Resetar todas as abas primeiro
            document.getElementById('tabHistorico').style.display = 'none';
            document.getElementById('tabFuncionarios').style.display = 'none';
            document.getElementById('tabSolicitacoes').style.display = 'none';
            document.getElementById('settingsLink').style.display = 'none';
            document.getElementById('adminBadge').style.display = 'none';
            
            // Mostrar abas baseado na fun√ß√£o
            if (isAdmin || funcao === 'ADM') {
                // ADM: Acesso total a tudo
                document.getElementById('tabHistorico').style.display = 'block';
                document.getElementById('tabAnalise').style.display = 'block';
                document.getElementById('tabFuncionarios').style.display = 'block';
                document.getElementById('tabSolicitacoes').style.display = 'block';
                document.getElementById('settingsLink').style.display = 'inline-block';
                document.getElementById('adminBadge').style.display = 'inline-block';
                // Ranking vis√≠vel na meta (n√£o precisa fazer nada, j√° est√° l√°)
            } else if (funcao === 'ASG') {
                // ASG: S√≥ acesso a Novo Registro e Meta
                // Esconder ranking na aba Meta
                currentUser.hideRanking = true;
            }
            
            // Atualizar interface
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('userInfo').classList.remove('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            document.getElementById('loggedUserName').textContent = currentUser.nome;
            document.getElementById('nome').value = currentUser.nome;
            
            // Limpar form de login
            document.getElementById('loginForm').reset();
        });

        function confirmLogout() {
            document.getElementById('confirmModal').classList.add('show');
        }

        function confirmLogoutYes() {
            document.getElementById('confirmModal').classList.remove('show');
            logout();
        }

        function confirmLogoutNo() {
            document.getElementById('confirmModal').classList.remove('show');
        }

        // Password Management Functions
        function showChangePasswordModal() {
            document.getElementById('changePasswordModal').classList.add('show');
            document.getElementById('changePasswordForm').reset();
        }

        function closeChangePasswordModal() {
            document.getElementById('changePasswordModal').classList.remove('show');
        }

        document.getElementById('changePasswordForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const currentPwd = document.getElementById('currentPassword').value;
            const newPwd = document.getElementById('newPassword').value;
            const confirmPwd = document.getElementById('confirmNewPassword').value;
            
            // Validar senha atual
            const senhaCorreta = FUNCIONARIOS[currentUser.matricula].senha || SENHA_PADRAO;
            if (currentPwd !== senhaCorreta) {
                showWarningModal('‚ùå', 'Senha Atual Incorreta', 'A senha atual que voc√™ digitou est√° incorreta. Por favor, verifique e tente novamente.');
                return;
            }
            
            // Validar nova senha
            if (newPwd.length < 6) {
                showWarningModal('‚ö†Ô∏è', 'Senha Muito Curta', 'A nova senha deve ter no m√≠nimo 6 caracteres. Por favor, escolha uma senha mais segura.');
                return;
            }
            
            // Validar confirma√ß√£o
            if (newPwd !== confirmPwd) {
                showWarningModal('‚ùå', 'Senhas N√£o Coincidem', 'A nova senha e a confirma√ß√£o n√£o s√£o iguais. Por favor, digite novamente.');
                return;
            }
            
            // Atualizar senha
            FUNCIONARIOS[currentUser.matricula].senha = newPwd;
            FUNCIONARIOS[currentUser.matricula].senhaAlterada = true;
            saveFuncionarios();
            
            closeChangePasswordModal();
            
            showSuccessModal();
            document.querySelector('.success-modal h2').textContent = 'Senha Alterada!';
            document.querySelector('.success-modal p').textContent = 'Sua senha foi alterada com sucesso!';
            
            setTimeout(() => {
                document.querySelector('.success-modal h2').textContent = 'Limpeza Registrada!';
                document.querySelector('.success-modal p').textContent = 'O registro foi salvo com sucesso no Google Sheets.';
            }, 3500);
        });

        function showForgotPasswordModal() {
            document.getElementById('forgotPasswordModal').classList.add('show');
            document.getElementById('forgotPasswordForm').reset();
        }

        function closeForgotPasswordModal() {
            document.getElementById('forgotPasswordModal').classList.remove('show');
        }

        document.getElementById('forgotPasswordForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const matricula = document.getElementById('forgotMatricula').value.trim();
            
            // Validar se matr√≠cula existe
            if (!FUNCIONARIOS[matricula]) {
                showInfoModal('‚ùå Matr√≠cula N√£o Encontrada', 'A matr√≠cula informada n√£o est√° cadastrada no sistema. Verifique o n√∫mero e tente novamente.');
                return;
            }
            
            // Criar solicita√ß√£o
            const requests = loadResetRequests();
            
            // Verificar se j√° existe solicita√ß√£o pendente
            const exists = requests.find(r => r.matricula === matricula && r.status === 'pendente');
            if (exists) {
                showInfoModal('‚ö†Ô∏è Solicita√ß√£o J√° Enviada', 'Voc√™ j√° tem uma solicita√ß√£o de reset de senha pendente. Aguarde a an√°lise dos administradores.');
                return;
            }
            
            const now = new Date();
            const request = {
                id: Date.now().toString(),
                matricula: matricula,
                nome: FUNCIONARIOS[matricula].nome,
                data: now.toLocaleDateString('pt-BR'),
                hora: now.toLocaleTimeString('pt-BR'),
                status: 'pendente'
            };
            
            requests.push(request);
            saveResetRequests(requests);
            
            closeForgotPasswordModal();
            
            alert('‚úÖ Solicita√ß√£o enviada aos administradores!\nAguarde a redefini√ß√£o da sua senha.');
        });

        function logout() {
            currentUser = null;
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('userInfo').classList.add('hidden');
            document.getElementById('mainApp').classList.add('hidden');
            
            // Esconder tab de hist√≥rico, an√°lise, funcion√°rios, solicita√ß√µes e badge de admin
            document.getElementById('tabHistorico').style.display = 'none';
            document.getElementById('tabAnalise').style.display = 'none';
            document.getElementById('tabFuncionarios').style.display = 'none';
            document.getElementById('tabSolicitacoes').style.display = 'none';
            document.getElementById('adminBadge').style.display = 'none';
            
            // Mostrar aba de novo registro, meta e feedback novamente
            document.querySelector('.tab[onclick*="novo"]').style.display = 'block';
            document.querySelector('.tab[onclick*="meta"]').style.display = 'block';
            // Mostrar ranking novamente
            document.getElementById('rankingSection').style.display = 'block';
            
            // RESETAR PARA ABA PADR√ÉO (NOVO REGISTRO)
            // Esconder todas as abas de conte√∫do
            const allTabContents = document.querySelectorAll('.tab-content');
            allTabContents.forEach(content => content.classList.remove('active'));
            
            // Desmarcar todas as tabs
            const allTabs = document.querySelectorAll('.tab');
            allTabs.forEach(tab => tab.classList.remove('active'));
            
            // Mostrar APENAS aba "Novo Registro"
            document.getElementById('novo').classList.add('active');
            document.querySelector('.tab[onclick*="novo"]').classList.add('active');
            
            // Limpar formul√°rio de checklist
            document.getElementById('checklistForm').reset();
            document.getElementById('observacoes').value = '';
            
            // Desmarcar checkboxes
            for (let i = 1; i <= 7; i++) {
                const checkbox = document.getElementById('item' + i);
                checkbox.checked = false;
                checkbox.closest('.checklist-item').classList.remove('checked');
            }
            
            photoData = null;
            document.getElementById('preview').style.display = 'none';
            document.getElementById('video').style.display = 'block';
            document.getElementById('captureBtn').style.display = 'none';
            document.getElementById('retakeBtn').style.display = 'none';
            
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
            }
        }

        // Verificar configura√ß√£o
        function checkConfiguration() {
            // Usar localStorage SE existir, sen√£o manter as URLs hardcoded
            const storedLimpeza = localStorage.getItem('googleScriptUrlLimpeza');
            const storedFeedback = localStorage.getItem('googleScriptUrlFeedback');
            
            // S√≥ sobrescrever se tiver valor no localStorage
            if (storedLimpeza) {
                SCRIPT_URL_LIMPEZA = storedLimpeza;
            }
            if (storedFeedback) {
                SCRIPT_URL_FEEDBACK = storedFeedback;
            }
            
            // Mostrar banner APENAS se N√ÉO tiver URLs (nem hardcoded nem localStorage)
            if (!SCRIPT_URL_LIMPEZA || !SCRIPT_URL_FEEDBACK || 
                SCRIPT_URL_LIMPEZA === 'COLE_AQUI_URL_SCRIPT_LIMPEZA' || 
                SCRIPT_URL_FEEDBACK === 'COLE_AQUI_URL_SCRIPT_AVALIACAO') {
                document.getElementById('configBanner').classList.add('show');
                updateStatus(false);
                
                // Preencher campos se j√° tiver alguma URL
                if (SCRIPT_URL_LIMPEZA && SCRIPT_URL_LIMPEZA !== 'COLE_AQUI_URL_SCRIPT_LIMPEZA') {
                    document.getElementById('scriptUrlLimpeza').value = SCRIPT_URL_LIMPEZA;
                }
                if (SCRIPT_URL_FEEDBACK && SCRIPT_URL_FEEDBACK !== 'COLE_AQUI_URL_SCRIPT_AVALIACAO') {
                    document.getElementById('scriptUrlFeedback').value = SCRIPT_URL_FEEDBACK;
                }
            } else {
                document.getElementById('configBanner').classList.remove('show');
                updateStatus(true);
            }
        }

        function saveScriptUrls() {
            const urlLimpeza = document.getElementById('scriptUrlLimpeza').value.trim();
            const urlFeedback = document.getElementById('scriptUrlFeedback').value.trim();
            
            // Validar URLs
            if (!urlLimpeza || !urlLimpeza.includes('script.google.com')) {
                alert('‚ùå URL de Limpeza inv√°lida! Certifique-se de copiar a URL completa do Google Apps Script.');
                return;
            }
            
            if (!urlFeedback || !urlFeedback.includes('script.google.com')) {
                alert('‚ùå URL de Feedback inv√°lida! Certifique-se de copiar a URL completa do Google Apps Script.');
                return;
            }
            
            // Salvar URLs
            localStorage.setItem('googleScriptUrlLimpeza', urlLimpeza);
            localStorage.setItem('googleScriptUrlFeedback', urlFeedback);
            SCRIPT_URL_LIMPEZA = urlLimpeza;
            SCRIPT_URL_FEEDBACK = urlFeedback;
            
            hideConfigBanner();
            updateStatus(true);
            showSuccessModal();
            
            // Mudar mensagem do modal
            document.querySelector('.success-modal h2').textContent = 'Configura√ß√£o Salva!';
            document.querySelector('.success-modal p').textContent = 'As URLs dos Google Apps Scripts foram configuradas com sucesso.';
            
            // Restaurar mensagem original ap√≥s fechar
            setTimeout(() => {
                document.querySelector('.success-modal h2').textContent = 'Limpeza Registrada!';
                document.querySelector('.success-modal p').textContent = 'O registro foi salvo com sucesso no Google Sheets.';
            }, 3500);
        }

        function updateStatus(online) {
            const indicator = document.getElementById('statusIndicator');
            if (online) {
                indicator.innerHTML = '<span class="status-online"></span>';
            } else {
                indicator.innerHTML = '<span class="status-offline"></span>';
            }
        }

        // Toggle checkbox visual
        function toggleCheckbox(id) {
            const checkbox = document.getElementById(id);
            checkbox.checked = !checkbox.checked;
            updateCheckboxStyle(checkbox);
        }

        function updateCheckboxStyle(checkbox) {
            const item = checkbox.closest('.checklist-item');
            if (checkbox.checked) {
                item.classList.add('checked');
            } else {
                item.classList.remove('checked');
            }
        }

        // Atualizar estilos dos checkboxes ao mudar
        document.addEventListener('DOMContentLoaded', function() {
            const checkboxes = document.querySelectorAll('.checklist-item input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    updateCheckboxStyle(this);
                });
            });
        });

        // C√¢mera
        async function startCamera() {
            try {
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'user' } 
                });
                const video = document.getElementById('video');
                video.srcObject = stream;
                video.style.display = 'block';
                document.getElementById('preview').style.display = 'none';
                document.getElementById('captureBtn').style.display = 'block';
                document.getElementById('retakeBtn').style.display = 'none';
            } catch (error) {
                alert('Erro ao acessar a c√¢mera: ' + error.message);
            }
        }

        function capturePhoto() {
            const video = document.getElementById('video');
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0);
            
            photoData = canvas.toDataURL('image/jpeg', 0.8);
            
            const preview = document.getElementById('preview');
            preview.src = photoData;
            preview.style.display = 'block';
            video.style.display = 'none';
            
            document.getElementById('captureBtn').style.display = 'none';
            document.getElementById('retakeBtn').style.display = 'block';
            
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
            }
        }

        function retakePhoto() {
            photoData = null;
            startCamera();
        }

        // Tabs
        function showTab(tabName) {
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            contents.forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            if (tabName === 'historico') {
                loadRecords();
            } else if (tabName === 'meta') {
                loadMeta();
                // Esconder ranking para ASG, mostrar s√≥ para ADM
                if (currentUser && currentUser.hideRanking) {
                    document.getElementById('rankingSection').style.display = 'none';
                } else {
                    document.getElementById('rankingSection').style.display = 'block';
                    exibirRanking(); // Atualizar ranking apenas para ADM
                }
            } else if (tabName === 'funcionarios') {
                loadEmployeeList();
            } else if (tabName === 'solicitacoes') {
                loadResetRequestsList();
            } else if (tabName === 'feedback') {
                checkFeedbackEligibility();
            }
        }

        // Meta Management
        function loadMeta() {
            const metaDescricao = localStorage.getItem('metaDescricao') || '';
            const metaPremiacao = localStorage.getItem('metaPremiacao') || '';
            
            document.getElementById('metaDescricao').value = metaDescricao;
            document.getElementById('metaPremiacao').value = metaPremiacao;
            
            const isAdmin = ADMINS.includes(currentUser.matricula);
            
            if (isAdmin) {
                // Habilitar edi√ß√£o
                document.getElementById('metaDescricao').removeAttribute('readonly');
                document.getElementById('metaPremiacao').removeAttribute('readonly');
                document.getElementById('metaButtons').style.display = 'flex';
                document.getElementById('infoAdmin').style.display = 'block';
                document.getElementById('infoFuncionario').style.display = 'none';
            } else {
                // Desabilitar edi√ß√£o
                document.getElementById('metaDescricao').setAttribute('readonly', 'true');
                document.getElementById('metaPremiacao').setAttribute('readonly', 'true');
                document.getElementById('metaButtons').style.display = 'none';
                document.getElementById('infoAdmin').style.display = 'none';
                document.getElementById('infoFuncionario').style.display = 'block';
            }
        }

        function saveMeta() {
            const metaDescricao = document.getElementById('metaDescricao').value.trim();
            const metaPremiacao = document.getElementById('metaPremiacao').value.trim();
            
            if (!metaDescricao || !metaPremiacao) {
                alert('‚ö†Ô∏è Por favor, preencha tanto a meta quanto a premia√ß√£o!');
                return;
            }
            
            localStorage.setItem('metaDescricao', metaDescricao);
            localStorage.setItem('metaPremiacao', metaPremiacao);
            
            // Mostrar modal de sucesso
            showSuccessModal();
            document.querySelector('.success-modal h2').textContent = 'Meta Atualizada!';
            document.querySelector('.success-modal p').textContent = 'A meta e premia√ß√£o foram atualizadas com sucesso!';
            
            setTimeout(() => {
                document.querySelector('.success-modal h2').textContent = 'Limpeza Registrada!';
                document.querySelector('.success-modal p').textContent = 'O registro foi salvo com sucesso no Google Sheets.';
            }, 3500);
        }

        function cancelEditMeta() {
            loadMeta();
        }

        // Form submit
        document.getElementById('checklistForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!SCRIPT_URL_LIMPEZA) {
                alert('‚ö†Ô∏è Configure a URL do Google Apps Script primeiro!');
                document.getElementById('configBanner').classList.add('show');
                return;
            }
            
            const nome = document.getElementById('nome').value;
            const local = document.getElementById('local').value;
            
            if (!photoData) {
                alert('Por favor, tire uma foto do funcion√°rio!');
                return;
            }
            
            // Coletar checklist items
            const checklistItems = [];
            for (let i = 1; i <= 7; i++) {
                const checkbox = document.getElementById('item' + i);
                if (checkbox.checked) {
                    checklistItems.push(checkbox.nextElementSibling.textContent.trim());
                }
            }
            
            // Verificar se pelo menos 1 item foi marcado
            if (checklistItems.length === 0) {
                alert('Por favor, marque pelo menos um item do checklist!');
                return;
            }
            
            const observacoes = document.getElementById('observacoes').value;
            
            const now = new Date();
            const record = {
                matricula: currentUser.matricula,
                nome: nome,
                local: local,
                foto: photoData,
                checklist: checklistItems.join('; '),
                observacoes: observacoes || 'Nenhuma',
                data: now.toLocaleDateString('pt-BR'),
                hora: now.toLocaleTimeString('pt-BR')
            };
            
            // Mostrar loading
            document.getElementById('submitLoading').classList.add('show');
            document.getElementById('submitBtn').disabled = true;
            
            try {
                // Enviar para Google Sheets - Planilha de Limpeza
                const response = await fetch(SCRIPT_URL_LIMPEZA, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(record)
                });
                
                // No-cors mode n√£o permite ler a resposta, ent√£o assumimos sucesso
                showSuccessModal();
                
                // Limpar formul√°rio (mant√©m nome)
                document.getElementById('local').value = '';
                document.getElementById('observacoes').value = '';
                
                // Desmarcar todos os checkboxes
                for (let i = 1; i <= 7; i++) {
                    const checkbox = document.getElementById('item' + i);
                    checkbox.checked = false;
                    updateCheckboxStyle(checkbox);
                }
                
                photoData = null;
                document.getElementById('preview').style.display = 'none';
                document.getElementById('video').style.display = 'block';
                document.getElementById('captureBtn').style.display = 'none';
                document.getElementById('retakeBtn').style.display = 'none';
                
                if (stream) {
                    stream.getTracks().forEach(track => track.stop());
                }
                
            } catch (error) {
                alert('Erro ao enviar dados: ' + error.message);
            } finally {
                document.getElementById('submitLoading').classList.remove('show');
                document.getElementById('submitBtn').disabled = false;
            }
        });

        // Modal de Sucesso
        function showSuccessModal() {
            const modal = document.getElementById('successModal');
            modal.classList.add('show');
            
            // Auto-fechar ap√≥s 3 segundos
            setTimeout(() => {
                closeSuccessModal();
            }, 3000);
        }

        function closeSuccessModal() {
            const modal = document.getElementById('successModal');
            modal.classList.remove('show');
        }

        // Mostrar/Ocultar Config Banner
        function showConfigBanner() {
            document.getElementById('configBanner').classList.add('show');
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function hideConfigBanner() {
            document.getElementById('configBanner').classList.remove('show');
        }

        // Carregar registros do Google Sheets
        async function loadRecords() {
            if (!SCRIPT_URL_LIMPEZA) {
                document.getElementById('recordsList').innerHTML = `
                    <div class="empty-state">
                        <h3>Configure a URL do Google Apps Script</h3>
                        <p>V√° em Configura√ß√µes e configure a URL de Limpeza</p>
                    </div>
                `;
                return;
            }
            
            document.getElementById('historyLoading').classList.add('show');
            document.getElementById('recordsList').innerHTML = '';
            
            try {
                const response = await fetch(SCRIPT_URL_LIMPEZA + '?action=get');
                const result = await response.json();
                
                if (result.status === 'success' && result.data) {
                    const records = result.data;
                    dadosOriginais = records; // Guardar para filtros
                    tipoHistoricoAtual = 'limpeza';
                    carregarFuncionariosNoFiltro();
                    displayRecords(records);
                } else {
                    throw new Error('Erro ao carregar dados');
                }
                
            } catch (error) {
                document.getElementById('recordsList').innerHTML = `
                    <div class="empty-state">
                        <h3>Erro ao carregar registros</h3>
                        <p>${error.message}</p>
                        <p>Verifique se a URL do Google Apps Script est√° correta</p>
                    </div>
                `;
            } finally {
                document.getElementById('historyLoading').classList.remove('show');
            }
        }

        function displayRecords(records) {
            const recordsList = document.getElementById('recordsList');
            
            if (records.length === 0) {
                recordsList.innerHTML = `
                    <div class="empty-state">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        <h3>Nenhum registro encontrado</h3>
                        <p>Comece registrando a primeira limpeza</p>
                    </div>
                `;
                updateStats([]);
                return;
            }
            
            // Reverter ordem para mostrar mais recente primeiro
            const reversedRecords = [...records].reverse();
            
            recordsList.innerHTML = reversedRecords.map(record => `
                <div class="record-card">
                    <div class="record-header">
                        <div class="record-name">üë§ ${record.Nome}</div>
                        <div class="record-local">üìç ${record.Local}</div>
                        <div class="record-time">${record.Data}<br>${record.Hora}</div>
                    </div>
                </div>
            `).join('');
            
            updateStats(records);
        }

        function updateStats(records) {
            const today = new Date().toLocaleDateString('pt-BR');
            const todayRecords = records.filter(r => r.Data === today);
            
            const stats = document.getElementById('stats');
            stats.innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${records.length}</div>
                    <div class="stat-label">Total de Limpezas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${new Set(records.map(r => r.Nome)).size}</div>
                    <div class="stat-label">Funcion√°rios Ativos</div>
                </div>
            `;
        }

        // Employee Management Functions
        function loadEmployeeList() {
            const list = document.getElementById('employeeList');
            const count = document.getElementById('employeeCount');
            
            const employees = Object.entries(FUNCIONARIOS).sort((a, b) => a[1].nome.localeCompare(b[1].nome));
            
            count.textContent = `Total de Funcion√°rios: ${employees.length}`;
            
            if (employees.length === 0) {
                list.innerHTML = '<p style="text-align:center;color:#999;padding:40px;">Nenhum funcion√°rio cadastrado</p>';
                return;
            }
            
            list.innerHTML = employees.map(([matricula, data]) => {
                const isAdmin = ADMINS.includes(matricula);
                let badgeClass = 'asg';
                let badgeText = data.funcao || 'ASG';
                
                if (isAdmin || data.funcao === 'ADM') {
                    badgeClass = 'adm';
                    badgeText = 'ADM';
                } else if (data.funcao === 'ASG') {
                    badgeClass = 'asg';
                    badgeText = 'ASG';
                }
                
                return `
                    <div class="employee-item">
                        <div class="employee-info">
                            <span class="employee-matricula">${matricula}</span>
                            <span class="employee-nome">${data.nome}</span>
                            <span class="funcao-badge ${badgeClass}">${badgeText}</span>
                        </div>
                        <div style="display:flex;gap:10px;">
                            <button class="btn-edit-employee" onclick="editarFuncionario('${matricula}')" title="Editar Fun√ß√£o">‚úèÔ∏è</button>
                            ${!isAdmin ? `<button class="btn-delete-employee" onclick="deleteEmployee('${matricula}')">üóëÔ∏è</button>` : `<span style="width:40px;"></span>`}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Editar fun√ß√£o do funcion√°rio
        function editarFuncionario(matricula) {
            const employee = FUNCIONARIOS[matricula];
            const modal = document.getElementById('confirmModal');
            
            modal.querySelector('.confirm-icon').textContent = '‚úèÔ∏è';
            modal.querySelector('.confirm-icon').style.background = 'linear-gradient(135deg, #FFD93D 0%, #FFC700 100%)';
            modal.querySelector('h2').textContent = 'Editar Funcion√°rio';
            modal.querySelector('p').innerHTML = `
                <strong>${employee.nome}</strong><br>
                Matr√≠cula: ${matricula}<br><br>
                <label style="display:block;margin-bottom:10px;text-align:left;font-weight:600;">Selecione a nova fun√ß√£o:</label>
                <select id="novaFuncao" style="width:100%;padding:12px;border:2px solid #E5E5E5;border-radius:12px;font-size:16px;margin-bottom:10px;">
                    <option value="ADM" ${employee.funcao === 'ADM' ? 'selected' : ''}>üëî Administrador (ADM)</option>
                    <option value="ASG" ${employee.funcao === 'ASG' ? 'selected' : ''}>üßπ Auxiliar de Servi√ßos Gerais (ASG)</option>
                </select>
            `;
            modal.querySelector('.confirm-modal-buttons').innerHTML = `
                <button class="btn-confirm-yes" onclick="salvarEdicaoFuncionario('${matricula}')">üíæ Salvar</button>
                <button class="btn-confirm-no" onclick="cancelarEdicao()">Cancelar</button>
            `;
            modal.classList.add('show');
        }

        function salvarEdicaoFuncionario(matricula) {
            const funcaoAntiga = FUNCIONARIOS[matricula].funcao;
            const novaFuncao = document.getElementById('novaFuncao').value;
            
            // Verificar se est√° tentando remover ADM do √∫ltimo administrador
            if (funcaoAntiga === 'ADM' && novaFuncao !== 'ADM') {
                const totalAdmins = Object.values(FUNCIONARIOS).filter(f => f.funcao === 'ADM').length;
                if (totalAdmins <= 1) {
                    document.getElementById('confirmModal').classList.remove('show');
                    showWarningModal('‚ö†Ô∏è', '√öltimo Administrador', 'N√£o √© poss√≠vel remover a fun√ß√£o ADM do √∫ltimo administrador do sistema. Adicione outro administrador antes de fazer essa altera√ß√£o.');
                    return;
                }
            }
            
            FUNCIONARIOS[matricula].funcao = novaFuncao;
            saveFuncionarios();
            loadEmployeeList();
            
            document.getElementById('confirmModal').classList.remove('show');
            
            showWarningModal('‚úÖ', 'Fun√ß√£o Atualizada!', `A fun√ß√£o do funcion√°rio foi alterada para: ${novaFuncao}`);
            
            // Restaurar modal
            setTimeout(() => {
                document.querySelector('.confirm-icon').textContent = '‚ö†Ô∏è';
                document.querySelector('.confirm-icon').style.background = 'linear-gradient(135deg, #E63946 0%, #FF6B6B 100%)';
                document.getElementById('confirmModal').querySelector('h2').textContent = 'Confirmar Sa√≠da';
                document.getElementById('confirmModal').querySelector('p').textContent = 'Voc√™ realmente deseja sair da sua conta?';
                document.querySelector('.confirm-modal-buttons').innerHTML = `
                    <button class="btn-confirm-yes" onclick="confirmLogoutYes()">Sim, Sair</button>
                    <button class="btn-confirm-no" onclick="confirmLogoutNo()">N√£o, Ficar</button>
                `;
            }, 300);
        }

        function cancelarEdicao() {
            document.getElementById('confirmModal').classList.remove('show');
            
            // Restaurar modal
            setTimeout(() => {
                document.querySelector('.confirm-icon').textContent = '‚ö†Ô∏è';
                document.querySelector('.confirm-icon').style.background = 'linear-gradient(135deg, #E63946 0%, #FF6B6B 100%)';
                document.getElementById('confirmModal').querySelector('h2').textContent = 'Confirmar Sa√≠da';
                document.getElementById('confirmModal').querySelector('p').textContent = 'Voc√™ realmente deseja sair da sua conta?';
                document.querySelector('.confirm-modal-buttons').innerHTML = `
                    <button class="btn-confirm-yes" onclick="confirmLogoutYes()">Sim, Sair</button>
                    <button class="btn-confirm-no" onclick="confirmLogoutNo()">N√£o, Ficar</button>
                `;
            }, 300);
        }

        function addEmployee() {
            const matricula = document.getElementById('newMatricula').value.trim();
            const nome = document.getElementById('newNome').value.trim().toUpperCase();
            const funcao = document.getElementById('newFuncao').value;
            
            if (!matricula || !nome || !funcao) {
                alert('‚ö†Ô∏è Por favor, preencha matr√≠cula, nome e fun√ß√£o!');
                return;
            }
            
            if (FUNCIONARIOS[matricula]) {
                alert('‚ö†Ô∏è Matr√≠cula j√° existe!');
                return;
            }
            
            FUNCIONARIOS[matricula] = {
                nome: nome,
                funcao: funcao,
                senha: SENHA_PADRAO,
                senhaAlterada: false
            };
            saveFuncionarios();
            
            document.getElementById('newMatricula').value = '';
            document.getElementById('newNome').value = '';
            document.getElementById('newFuncao').value = '';
            
            loadEmployeeList();
            
            showSuccessModal();
            document.querySelector('.success-modal h2').textContent = 'Funcion√°rio Adicionado!';
            document.querySelector('.success-modal p').textContent = `${nome} foi adicionado como ${funcao}!`;
            
            setTimeout(() => {
                document.querySelector('.success-modal h2').textContent = 'Limpeza Registrada!';
                document.querySelector('.success-modal p').textContent = 'O registro foi salvo com sucesso no Google Sheets.';
            }, 3500);
        }

        function deleteEmployee(matricula) {
            const modal = document.getElementById('confirmModal');
            const employee = FUNCIONARIOS[matricula];
            
            modal.querySelector('.confirm-icon').textContent = 'üóëÔ∏è';
            modal.querySelector('h2').textContent = 'Excluir Funcion√°rio?';
            modal.querySelector('p').textContent = `Tem certeza que deseja remover ${employee.nome} do sistema? Esta a√ß√£o n√£o pode ser desfeita.`;
            modal.querySelector('.confirm-modal-buttons').innerHTML = `
                <button class="btn-confirm-yes" onclick="confirmDeleteEmployee('${matricula}')">Sim, Excluir</button>
                <button class="btn-confirm-no" onclick="cancelDeleteEmployee()">Cancelar</button>
            `;
            modal.classList.add('show');
        }

        function confirmDeleteEmployee(matricula) {
            delete FUNCIONARIOS[matricula];
            saveFuncionarios();
            loadEmployeeList();
            
            document.getElementById('confirmModal').classList.remove('show');
            
            // Restaurar modal
            setTimeout(() => {
                document.querySelector('.confirm-icon').textContent = '‚ö†Ô∏è';
                document.getElementById('confirmModal').querySelector('h2').textContent = 'Confirmar Sa√≠da';
                document.getElementById('confirmModal').querySelector('p').textContent = 'Voc√™ realmente deseja sair da sua conta?';
                document.querySelector('.confirm-modal-buttons').innerHTML = `
                    <button class="btn-confirm-yes" onclick="confirmLogoutYes()">Sim, Sair</button>
                    <button class="btn-confirm-no" onclick="confirmLogoutNo()">N√£o, Ficar</button>
                `;
            }, 300);
        }

        function cancelDeleteEmployee() {
            document.getElementById('confirmModal').classList.remove('show');
            
            // Restaurar modal
            setTimeout(() => {
                document.querySelector('.confirm-icon').textContent = '‚ö†Ô∏è';
                document.getElementById('confirmModal').querySelector('h2').textContent = 'Confirmar Sa√≠da';
                document.getElementById('confirmModal').querySelector('p').textContent = 'Voc√™ realmente deseja sair da sua conta?';
                document.querySelector('.confirm-modal-buttons').innerHTML = `
                    <button class="btn-confirm-yes" onclick="confirmLogoutYes()">Sim, Sair</button>
                    <button class="btn-confirm-no" onclick="confirmLogoutNo()">N√£o, Ficar</button>
                `;
            }, 300);
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                const fileName = file.name.toLowerCase();
                
                // Verificar extens√£o
                if (fileName.endsWith('.xlsx') || fileName.endsWith('.xls')) {
                    readExcelFile(file);
                } else {
                    readFile(file); // CSV ou TXT
                }
            }
        }

        function readExcelFile(file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, {type: 'array'});
                    
                    // Pegar primeira planilha
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    
                    // Converter para array de arrays
                    const rows = XLSX.utils.sheet_to_json(firstSheet, {header: 1});
                    
                    // Processar como CSV
                    const csvText = rows.map(row => row.join(',')).join('\n');
                    processCSVText(csvText);
                    
                } catch (error) {
                    alert('‚ùå Erro ao ler arquivo Excel: ' + error.message);
                }
            };
            
            reader.readAsArrayBuffer(file);
        }

        function processCSVText(text) {
            const lines = text.split('\n').filter(line => line.trim());
            
            // FASE 1: Validar TODAS as linhas ANTES de adicionar qualquer uma
            const novosFuncionarios = [];
            const duplicatas = [];
            
            lines.forEach((line, index) => {
                // Pular linha de cabe√ßalho se existir
                if (index === 0 && line.toUpperCase().includes('MATRICULA')) {
                    return;
                }
                
                const parts = line.split(',');
                if (parts.length >= 2) {
                    const matricula = parts[0].trim();
                    const nome = parts[1].trim().toUpperCase();
                    const funcao = parts.length >= 3 ? parts[2].trim() : 'Funcion√°rio';
                    
                    // Validar fun√ß√£o
                    const funcaoValida = ['ASG', 'Funcion√°rio', 'Funcionario'].includes(funcao) ? funcao : 'Funcion√°rio';
                    
                    if (matricula && nome) {
                        // Verificar se j√° existe
                        if (FUNCIONARIOS[matricula]) {
                            duplicatas.push({
                                matricula: matricula,
                                nome: FUNCIONARIOS[matricula].nome
                            });
                        } else {
                            novosFuncionarios.push({
                                matricula: matricula,
                                nome: nome,
                                funcao: funcaoValida === 'Funcionario' ? 'Funcion√°rio' : funcaoValida
                            });
                        }
                    }
                }
            });
            
            // FASE 2: Se houver duplicatas, BLOQUEAR tudo e mostrar erro
            if (duplicatas.length > 0) {
                let mensagem = '‚ö†Ô∏è ERRO AO IMPORTAR!\n\n';
                mensagem += 'As seguintes matr√≠culas J√Å EXISTEM no sistema:\n\n';
                
                duplicatas.forEach(dup => {
                    mensagem += `‚Ä¢ ${dup.matricula} - ${dup.nome}\n`;
                });
                
                mensagem += '\n‚ùå NENHUM funcion√°rio foi adicionado.\n';
                mensagem += 'Por favor, remova as matr√≠culas duplicadas do arquivo e tente novamente.';
                
                alert(mensagem);
                return; // BLOQUEIA A IMPORTA√á√ÉO
            }
            
            // FASE 3: Se n√£o houver duplicatas, adicionar TODOS
            let added = 0;
            novosFuncionarios.forEach(func => {
                FUNCIONARIOS[func.matricula] = {
                    nome: func.nome,
                    funcao: func.funcao,
                    senha: SENHA_PADRAO,
                    senhaAlterada: false
                };
                added++;
            });
            
            saveFuncionarios();
            loadEmployeeList();
            
            showSuccessModal();
            document.querySelector('.success-modal h2').textContent = 'Importa√ß√£o Conclu√≠da!';
            document.querySelector('.success-modal p').textContent = `‚úÖ ${added} funcion√°rio(s) adicionado(s) com sucesso!`;
            
            setTimeout(() => {
                document.querySelector('.success-modal h2').textContent = 'Limpeza Registrada!';
                document.querySelector('.success-modal p').textContent = 'O registro foi salvo com sucesso no Google Sheets.';
            }, 3500);
        }

        function handleDragOver(event) {
            event.preventDefault();
            event.currentTarget.classList.add('dragover');
        }

        function handleDragLeave(event) {
            event.currentTarget.classList.remove('dragover');
        }

        function handleDrop(event) {
            event.preventDefault();
            event.currentTarget.classList.remove('dragover');
            
            const file = event.dataTransfer.files[0];
            if (file) {
                readFile(file);
            }
        }

        function readFile(file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                processCSVText(e.target.result);
            };
            
            reader.readAsText(file);
        }

        // Reset Requests Management
        function loadResetRequestsList() {
            const requests = loadResetRequests();
            const pendingRequests = requests.filter(r => r.status === 'pendente');
            
            const count = document.getElementById('requestsCount');
            const list = document.getElementById('requestsList');
            
            count.textContent = `Solicita√ß√µes Pendentes: ${pendingRequests.length}`;
            
            if (pendingRequests.length === 0) {
                list.innerHTML = '<p style="text-align:center;color:#999;padding:40px;">Nenhuma solicita√ß√£o pendente</p>';
                return;
            }
            
            list.innerHTML = pendingRequests.map(req => `
                <div class="employee-item">
                    <div class="employee-info">
                        <span class="employee-matricula">${req.matricula}</span>
                        <span class="employee-nome">${req.nome}</span>
                        <span style="font-size:12px;color:#999;margin-left:10px;">${req.data} - ${req.hora}</span>
                    </div>
                    <div style="display:flex;gap:10px;">
                        <button class="btn-primary" style="padding:8px 16px;font-size:12px;" onclick="approveResetRequest('${req.id}')">‚úÖ Resetar Senha</button>
                        <button class="btn-secondary" style="padding:8px 16px;font-size:12px;background:#dc3545;" onclick="denyResetRequest('${req.id}')">‚ùå Ignorar</button>
                    </div>
                </div>
            `).join('');
        }

        function approveResetRequest(requestId) {
            if (!confirm('Resetar senha deste funcion√°rio?\nA senha voltar√° para: datametrica2026')) {
                return;
            }
            
            const requests = loadResetRequests();
            const request = requests.find(r => r.id === requestId);
            
            if (!request) return;
            
            // Resetar senha
            FUNCIONARIOS[request.matricula].senha = SENHA_PADRAO;
            FUNCIONARIOS[request.matricula].senhaAlterada = false;
            saveFuncionarios();
            
            // Remover solicita√ß√£o
            const updatedRequests = requests.filter(r => r.id !== requestId);
            saveResetRequests(updatedRequests);
            
            // Recarregar lista
            loadResetRequestsList();
            
            showSuccessModal();
            document.querySelector('.success-modal h2').textContent = 'Senha Resetada!';
            document.querySelector('.success-modal p').textContent = `Senha de ${request.nome} foi resetada para: datametrica2026`;
            
            setTimeout(() => {
                document.querySelector('.success-modal h2').textContent = 'Limpeza Registrada!';
                document.querySelector('.success-modal p').textContent = 'O registro foi salvo com sucesso no Google Sheets.';
            }, 3500);
        }

        function denyResetRequest(requestId) {
            if (!confirm('Ignorar esta solicita√ß√£o?')) {
                return;
            }
            
            const requests = loadResetRequests();
            const updatedRequests = requests.filter(r => r.id !== requestId);
            saveResetRequests(updatedRequests);
            
            loadResetRequestsList();
        }

        // Feedback System (c√≥digo removido - ser√° implementado em nova conversa)
        let selectedAndar = '';

        // Modal de informa√ß√£o customizado (substitui alert)
        function showInfoModal(title, message) {
            const modal = document.getElementById('confirmModal');
            modal.querySelector('h2').textContent = title;
            modal.querySelector('p').textContent = message;
            modal.querySelector('.confirm-modal-buttons').innerHTML = '<button class="btn-confirm-yes" onclick="closeInfoModal()">OK, Entendi</button>';
            modal.classList.add('show');
        }

        function closeInfoModal() {
            document.getElementById('confirmModal').classList.remove('show');
            // Restaurar bot√µes originais do modal de logout
            setTimeout(() => {
                document.querySelector('.confirm-modal-buttons').innerHTML = `
                    <button class="btn-confirm-yes" onclick="confirmLogoutYes()">Sim, Sair</button>
                    <button class="btn-confirm-no" onclick="confirmLogoutNo()">N√£o, Ficar</button>
                `;
                document.getElementById('confirmModal').querySelector('h2').textContent = 'Confirmar Sa√≠da';
                document.getElementById('confirmModal').querySelector('p').textContent = 'Voc√™ realmente deseja sair da sua conta?';
            }, 300);
        }

        // Modal de aviso que fica sempre na frente
        function showWarningModal(icon, title, message) {
            document.getElementById('warningIcon').textContent = icon;
            document.getElementById('warningTitle').textContent = title;
            document.getElementById('warningMessage').textContent = message;
            document.getElementById('warningModal').classList.add('show');
        }

        // Modal de aviso que fica sempre na frente
        // ============================================
        // FILTROS AVAN√áADOS NO HIST√ìRICO
        // ============================================
        
        let dadosOriginais = [];
        let tipoHistoricoAtual = 'limpeza';

        // Carregar lista de funcion√°rios no filtro
        function carregarFuncionariosNoFiltro() {
            const select = document.getElementById('filtroFuncionario');
            select.innerHTML = '<option value="todos">Todos os funcion√°rios</option>';
            
            Object.entries(FUNCIONARIOS).forEach(([matricula, data]) => {
                const option = document.createElement('option');
                option.value = matricula;
                option.textContent = `${data.nome} (${matricula})`;
                select.appendChild(option);
            });
        }

        // Mostrar/esconder filtro de avalia√ß√£o
        document.getElementById('filtroPeriodo')?.addEventListener('change', function() {
            const customDiv = document.getElementById('datasCustomizadas');
            if (this.value === 'custom') {
                customDiv.style.display = 'grid';
            } else {
                customDiv.style.display = 'none';
            }
        });

        // Aplicar filtros
        function aplicarFiltros() {
            if (tipoHistoricoAtual === 'limpeza') {
                filtrarLimpezas();
            } else {
                filtrarFeedbacks();
            }
        }

        function filtrarLimpezas() {
            let dadosFiltrados = [...dadosOriginais];
            
            // Filtro por per√≠odo
            const periodo = document.getElementById('filtroPeriodo').value;
            if (periodo !== 'todos') {
                dadosFiltrados = filtrarPorPeriodo(dadosFiltrados, periodo);
            }
            
            // Filtro por funcion√°rio
            const funcionario = document.getElementById('filtroFuncionario').value;
            if (funcionario !== 'todos') {
                dadosFiltrados = dadosFiltrados.filter(r => r.Matr√≠cula === funcionario);
            }
            
            // Filtro por andar (extrair do local)
            const andar = document.getElementById('filtroAndar').value;
            if (andar !== 'todos') {
                dadosFiltrados = dadosFiltrados.filter(r => r.Local?.includes(andar));
            }
            
            displayRecords(dadosFiltrados);
        }

        function filtrarFeedbacks() {
            let dadosFiltrados = [...dadosOriginais];
            
            // Filtro por per√≠odo
            const periodo = document.getElementById('filtroPeriodo').value;
            if (periodo !== 'todos') {
                dadosFiltrados = filtrarPorPeriodo(dadosFiltrados, periodo);
            }
            
            // Filtro por funcion√°rio
            const funcionario = document.getElementById('filtroFuncionario').value;
            if (funcionario !== 'todos' && funcionario !== 'An√¥nimo') {
                dadosFiltrados = dadosFiltrados.filter(f => f.Matr√≠cula === funcionario);
            } else if (funcionario === 'An√¥nimo') {
                dadosFiltrados = dadosFiltrados.filter(f => f.Matr√≠cula === 'An√¥nimo' || f.Nome === 'An√¥nimo');
            }
            
            // Filtro por andar
            const andar = document.getElementById('filtroAndar').value;
            if (andar !== 'todos') {
                dadosFiltrados = dadosFiltrados.filter(f => f.Andar === andar);
            }
            
            // Filtro por avalia√ß√£o
            const avaliacao = document.getElementById('filtroAvaliacao').value;
            if (avaliacao !== 'todos') {
                if (avaliacao === 'baixo') {
                    dadosFiltrados = dadosFiltrados.filter(f => {
                        const media = calcularMediaFeedback(f);
                        return media <= 2;
                    });
                } else {
                    dadosFiltrados = dadosFiltrados.filter(f => {
                        const media = calcularMediaFeedback(f);
                        return Math.round(media) === parseInt(avaliacao);
                    });
                }
            }
            
            displayFeedbacks(dadosFiltrados);
        }

        function filtrarPorPeriodo(dados, periodo) {
            const hoje = new Date();
            hoje.setHours(0, 0, 0, 0);
            
            if (periodo === 'hoje') {
                return dados.filter(d => {
                    const dataRegistro = parseDataBR(d.Data);
                    return dataRegistro >= hoje;
                });
            } else if (periodo === 'semana') {
                const semanaAtras = new Date(hoje);
                semanaAtras.setDate(hoje.getDate() - 7);
                return dados.filter(d => {
                    const dataRegistro = parseDataBR(d.Data);
                    return dataRegistro >= semanaAtras;
                });
            } else if (periodo === 'mes') {
                const mesAtras = new Date(hoje);
                mesAtras.setMonth(hoje.getMonth() - 1);
                return dados.filter(d => {
                    const dataRegistro = parseDataBR(d.Data);
                    return dataRegistro >= mesAtras;
                });
            } else if (periodo === 'custom') {
                const inicio = new Date(document.getElementById('dataInicio').value);
                const fim = new Date(document.getElementById('dataFim').value);
                fim.setHours(23, 59, 59, 999);
                
                return dados.filter(d => {
                    const dataRegistro = parseDataBR(d.Data);
                    return dataRegistro >= inicio && dataRegistro <= fim;
                });
            }
            
            return dados;
        }

        function parseDataBR(dataStr) {
            // Converte DD/MM/YYYY para Date
            const partes = dataStr.split('/');
            return new Date(partes[2], partes[1] - 1, partes[0]);
        }

        function calcularMediaFeedback(feedback) {
            const notas = [
                feedback.Vaso || 0,
                feedback.Pia || 0,
                feedback.Cabine || 0,
                feedback['Ch√£o Banheiro'] || 0,
                feedback.Papel || 0,
                feedback.Sabonete || 0
            ].filter(n => n > 0);
            
            return notas.length > 0 ? notas.reduce((a, b) => a + b) / notas.length : 0;
        }

        function limparFiltros() {
            document.getElementById('filtroPeriodo').value = 'todos';
            document.getElementById('filtroFuncionario').value = 'todos';
            document.getElementById('filtroAndar').value = 'todos';
            document.getElementById('filtroAvaliacao').value = 'todos';
            document.getElementById('dataInicio').value = '';
            document.getElementById('dataFim').value = '';
            document.getElementById('datasCustomizadas').style.display = 'none';
            
            aplicarFiltros();
        }

        // ============================================
        // SISTEMA DE RANKING E PONTOS
        // ============================================
        
        function calcularPontos() {
            const pontos = {};
            
            // Inicializar pontos
            Object.keys(FUNCIONARIOS).forEach(matricula => {
                pontos[matricula] = {
                    nome: FUNCIONARIOS[matricula].nome,
                    funcao: FUNCIONARIOS[matricula].funcao,
                    pontos: 0,
                    limpezas: 0,
                    feedbacks5estrelas: 0
                };
            });
            
            // Contar limpezas (10 pontos cada)
            if (dadosOriginais && tipoHistoricoAtual === 'limpeza') {
                dadosOriginais.forEach(registro => {
                    if (pontos[registro.Matr√≠cula]) {
                        pontos[registro.Matr√≠cula].pontos += 10;
                        pontos[registro.Matr√≠cula].limpezas += 1;
                    }
                });
            }
            
            // Contar feedbacks 5 estrelas (50 pontos cada)
            const feedbacks = JSON.parse(localStorage.getItem('feedbacks') || '[]');
            feedbacks.forEach(f => {
                const media = calcularMediaFeedback(f);
                if (media >= 4.5 && pontos[f.matricula]) {
                    pontos[f.matricula].pontos += 50;
                    pontos[f.matricula].feedbacks5estrelas += 1;
                }
            });
            
            return pontos;
        }

        function exibirRanking() {
            const pontos = calcularPontos();
            const ranking = Object.entries(pontos)
                .filter(([_, data]) => data.funcao === 'ASG') // S√≥ ASG no ranking
                .sort((a, b) => b[1].pontos - a[1].pontos)
                .slice(0, 10);
            
            const container = document.getElementById('rankingContainer');
            if (!container) return;
            
            if (ranking.length === 0) {
                container.innerHTML = '<p style="text-align:center;color:#999;padding:40px;">Nenhum dado de ranking ainda.</p>';
                return;
            }
            
            container.innerHTML = ranking.map(([matricula, data], index) => {
                const medalha = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `${index + 1}¬∫`;
                const destaque = index < 3 ? 'background:linear-gradient(135deg, #FFF9E6 0%, #FFEDD5 100%);border:2px solid #FFD93D;' : '';
                
                return `
                    <div style="display:flex;align-items:center;justify-content:space-between;padding:15px 20px;background:white;border-radius:12px;margin-bottom:12px;box-shadow:0 2px 8px rgba(0,0,0,0.08);${destaque}">
                        <div style="display:flex;align-items:center;gap:15px;flex:1;">
                            <div style="font-size:28px;min-width:50px;text-align:center;">${medalha}</div>
                            <div style="flex:1;">
                                <div style="font-weight:700;font-size:16px;color:#2C3E50;">${data.nome}</div>
                                <div style="font-size:13px;color:#666;margin-top:3px;">
                                    ${data.limpezas} limpezas ‚Ä¢ ${data.feedbacks5estrelas} feedbacks 5‚≠ê
                                </div>
                            </div>
                        </div>
                        <div style="text-align:right;">
                            <div style="font-size:24px;font-weight:900;color:#E63946;">${data.pontos}</div>
                            <div style="font-size:12px;color:#666;">pontos</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function closeWarningModal() {
            document.getElementById('warningModal').classList.remove('show');
        }

        // Filtrar funcion√°rios
        function filterEmployees() {
            const searchTerm = document.getElementById('searchEmployee').value.toLowerCase();
            const employees = Object.entries(FUNCIONARIOS).sort((a, b) => a[1].nome.localeCompare(b[1].nome));
            
            const filtered = employees.filter(([matricula, data]) => {
                return matricula.includes(searchTerm) || data.nome.toLowerCase().includes(searchTerm);
            });
            
            const list = document.getElementById('employeeList');
            const count = document.getElementById('employeeCount');
            
            count.textContent = `Total de Funcion√°rios: ${employees.length} ${filtered.length !== employees.length ? `(${filtered.length} encontrados)` : ''}`;
            
            if (filtered.length === 0) {
                list.innerHTML = '<p style="text-align:center;color:#999;padding:40px;">Nenhum funcion√°rio encontrado</p>';
                return;
            }
            
            list.innerHTML = filtered.map(([matricula, data]) => {
                const isAdmin = ADMINS.includes(matricula);
                let badgeClass = 'asg';
                let badgeText = data.funcao || 'ASG';
                
                if (isAdmin || data.funcao === 'ADM') {
                    badgeClass = 'adm';
                    badgeText = 'ADM';
                } else if (data.funcao === 'ASG') {
                    badgeClass = 'asg';
                    badgeText = 'ASG';
                }
                
                return `
                    <div class="employee-item">
                        <div class="employee-info">
                            <span class="employee-matricula">${matricula}</span>
                            <span class="employee-nome">${data.nome}</span>
                            <span class="funcao-badge ${badgeClass}">${badgeText}</span>
                        </div>
                        ${!isAdmin ? `<button class="btn-delete-employee" onclick="deleteEmployee('${matricula}')">üóëÔ∏è Remover</button>` : ''}
                    </div>
                `;
            }).join('');
        }

        // Hist√≥rico - Alternar entre Limpeza e Feedback
        let historicoAtual = 'limpeza';

        function showHistoricoLimpeza() {
            historicoAtual = 'limpeza';
            tipoHistoricoAtual = 'limpeza';
            document.getElementById('btnHistoricoLimpeza').classList.add('selected');
            document.getElementById('btnHistoricoFeedback').classList.remove('selected');
            document.getElementById('filtroAvaliacaoDiv').style.display = 'none'; // Esconder filtro de avalia√ß√£o
            loadRecords();
        }

        function showHistoricoFeedback() {
            historicoAtual = 'feedback';
            document.getElementById('btnHistoricoFeedback').classList.add('selected');
            document.getElementById('btnHistoricoLimpeza').classList.remove('selected');
            loadFeedbackHistory();
        }

        async function loadFeedbackHistory() {
            if (!SCRIPT_URL_FEEDBACK) {
                document.getElementById('recordsList').innerHTML = `
                    <div class="empty-state">
                        <h3>Configure a URL do Google Apps Script - Feedback</h3>
                        <p>V√° em Configura√ß√µes e configure primeiro</p>
                    </div>
                `;
                return;
            }
            
            document.getElementById('historyLoading').classList.add('show');
            document.getElementById('recordsList').innerHTML = '';
            document.getElementById('stats').innerHTML = '';
            
            try {
                const response = await fetch(SCRIPT_URL_FEEDBACK + '?action=get');
                const result = await response.json();
                
                if (result.status === 'success' && result.data) {
                    const feedbacks = result.data;
                    dadosOriginais = feedbacks; // Guardar para filtros
                    tipoHistoricoAtual = 'feedback';
                    carregarFuncionariosNoFiltro();
                    document.getElementById('filtroAvaliacaoDiv').style.display = 'block'; // Mostrar filtro de avalia√ß√£o
                    displayFeedbacks(feedbacks);
                }
            } catch (error) {
                document.getElementById('recordsList').innerHTML = `
                    <div class="empty-state">
                        <h3>‚ùå Erro ao carregar feedbacks</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
            
            document.getElementById('historyLoading').classList.remove('show');
        }

        function displayFeedbacks(feedbacks) {
            const list = document.getElementById('recordsList');
            const stats = document.getElementById('stats');
            
            if (!feedbacks || feedbacks.length === 0) {
                list.innerHTML = '<div class="empty-state"><h3>Nenhum feedback registrado ainda</h3></div>';
                return;
            }
            
            // Estat√≠sticas
            const total = feedbacks.length;
            const anonimos = feedbacks.filter(f => f.Matr√≠cula === 'An√¥nimo' || f.Nome === 'An√¥nimo').length;
            
            stats.innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${total}</div>
                    <div class="stat-label">Total de Feedbacks</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${total - anonimos}</div>
                    <div class="stat-label">Identificados</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${anonimos}</div>
                    <div class="stat-label">An√¥nimos</div>
                </div>
            `;
            
            // Lista de feedbacks
            list.innerHTML = feedbacks.reverse().map(feedback => `
                <div class="record-card">
                    <div class="record-header">
                        <span class="record-badge">${feedback.Nome || 'An√¥nimo'}</span>
                        <span class="record-date">${feedback.Data} - ${feedback.Hora}</span>
                    </div>
                    <div class="record-info">
                        <strong>Andar:</strong> ${feedback.Andar}<br>
                        ${feedback.Coment√°rios && feedback.Coment√°rios !== 'Nenhum' ? `<strong>Coment√°rios:</strong> ${feedback.Coment√°rios}` : ''}
                    </div>
                    ${feedback.Vaso ? `
                    <div class="record-details" style="margin-top:10px;padding:10px;background:#F8F9FA;border-radius:8px;font-size:13px;">
                        <strong>Avalia√ß√µes:</strong> 
                        Vaso: ${feedback.Vaso}‚≠ê | 
                        Pia: ${feedback.Pia}‚≠ê | 
                        Cabine: ${feedback.Cabine}‚≠ê | 
                        Ch√£o Banheiro: ${feedback['Ch√£o Banheiro']}‚≠ê | 
                        Papel: ${feedback.Papel}‚≠ê | 
                        Sabonete: ${feedback.Sabonete}‚≠ê
                    </div>
                    ` : ''}
                </div>
            `).join('');
        }

        // Resetar limite de feedback
        function resetarLimiteFeedback() {
            const matricula = document.getElementById('matriculaResetFeedback').value.trim();
            
            if (!matricula) {
                showWarningModal('‚ö†Ô∏è', 'Matr√≠cula Vazia', 'Por favor, digite a matr√≠cula do funcion√°rio.');
                return;
            }
            
            if (!FUNCIONARIOS[matricula]) {
                showWarningModal('‚ùå', 'Matr√≠cula N√£o Encontrada', 'A matr√≠cula informada n√£o existe no sistema.');
                return;
            }
            
            const key = `feedback_${matricula}_date`;
            const hadLimit = localStorage.getItem(key) !== null;
            
            localStorage.removeItem(key);
            document.getElementById('matriculaResetFeedback').value = '';
            
            if (hadLimit) {
                showWarningModal('‚úÖ', 'Limite Resetado!', `O funcion√°rio ${FUNCIONARIOS[matricula].nome} agora pode enviar novo feedback.`);
            } else {
                showWarningModal('‚ÑπÔ∏è', 'Sem Limite', `O funcion√°rio ${FUNCIONARIOS[matricula].nome} n√£o tinha limite de feedback ativo.`);
            }
        }

        // ============================================
        // MODO OFFLINE
        // ============================================
        
        let isOnline = navigator.onLine;
        let pendingSync = JSON.parse(localStorage.getItem('pendingSync') || '[]');

        // Detectar mudan√ßas de status online/offline
        window.addEventListener('online', () => {
            isOnline = true;
            updateOnlineStatus();
            sincronizarDadosPendentes();
        });

        window.addEventListener('offline', () => {
            isOnline = false;
            updateOnlineStatus();
        });

        function updateOnlineStatus() {
            const indicator = document.getElementById('statusIndicator');
            if (isOnline) {
                indicator.innerHTML = 'üü¢';
                indicator.title = 'Online';
            } else {
                indicator.innerHTML = 'üî¥';
                indicator.title = 'Offline - Dados ser√£o sincronizados quando voltar online';
            }
        }

        async function sincronizarDadosPendentes() {
            if (!isOnline || pendingSync.length === 0) return;

            showWarningModal('üîÑ', 'Sincronizando...', `Enviando ${pendingSync.length} registro(s) pendente(s)...`);

            for (let i = 0; i < pendingSync.length; i++) {
                const item = pendingSync[i];
                try {
                    if (item.type === 'limpeza') {
                        await fetch(SCRIPT_URL_LIMPEZA, {
                            method: 'POST',
                            mode: 'no-cors',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(item.data)
                        });
                    } else if (item.type === 'feedback') {
                        await fetch(SCRIPT_URL_FEEDBACK, {
                            method: 'POST',
                            mode: 'no-cors',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(item.data)
                        });
                    }
                    pendingSync.splice(i, 1);
                    i--;
                } catch (error) {
                    console.error('Erro ao sincronizar:', error);
                }
            }

            localStorage.setItem('pendingSync', JSON.stringify(pendingSync));
            
            if (pendingSync.length === 0) {
                closeWarningModal();
                showWarningModal('‚úÖ', 'Sincroniza√ß√£o Completa!', 'Todos os dados foram enviados com sucesso.');
            }
        }

        // Adicionar item √† fila de sincroniza√ß√£o quando offline
        function adicionarFilaSincronizacao(type, data) {
            pendingSync.push({ type, data, timestamp: new Date().toISOString() });
            localStorage.setItem('pendingSync', JSON.stringify(pendingSync));
        }

        // ============================================
        // AN√ÅLISE IA
        // ============================================
        
        async function gerarAnaliseIA() {
            document.getElementById('analiseLoading').style.display = 'block';
            document.getElementById('analiseResults').style.display = 'none';

            // Simular processamento (em produ√ß√£o, seria uma chamada para API de IA)
            await new Promise(resolve => setTimeout(resolve, 2000));

            // Coletar dados
            const feedbacks = JSON.parse(localStorage.getItem('feedbacks') || '[]');
            const funcionarios = Object.values(FUNCIONARIOS);

            // An√°lise de tend√™ncias
            const analise = analisarDados(feedbacks);

            // Exibir resultados
            exibirAnalise(analise);

            document.getElementById('analiseLoading').style.display = 'none';
            document.getElementById('analiseResults').style.display = 'block';
        }

        function analisarDados(feedbacks) {
            const analise = {
                tendencias: [],
                problemas: [],
                sugestoes: [],
                estatisticas: {}
            };

            if (feedbacks.length === 0) {
                analise.tendencias.push('‚ö†Ô∏è Sem dados suficientes para an√°lise. Aguarde mais feedbacks.');
                return analise;
            }

            // An√°lise por andar
            const porAndar = {};
            feedbacks.forEach(f => {
                if (!porAndar[f.andar]) porAndar[f.andar] = [];
                porAndar[f.andar].push(f);
            });

            // Identificar tend√™ncias
            Object.entries(porAndar).forEach(([andar, fbs]) => {
                const mediaVaso = fbs.filter(f => f.vaso).reduce((acc, f) => acc + f.vaso, 0) / fbs.filter(f => f.vaso).length;
                const mediaPia = fbs.filter(f => f.pia).reduce((acc, f) => acc + f.pia, 0) / fbs.filter(f => f.pia).length;
                
                if (mediaVaso < 3) {
                    analise.problemas.push(`‚ùå ${andar}: Vasos sanit√°rios com avalia√ß√£o baixa (${mediaVaso.toFixed(1)}/5)`);
                    analise.sugestoes.push(`üí° Aumentar frequ√™ncia de limpeza dos vasos no ${andar}`);
                }
                
                if (mediaPia < 3) {
                    analise.problemas.push(`‚ùå ${andar}: Pias com avalia√ß√£o baixa (${mediaPia.toFixed(1)}/5)`);
                    analise.sugestoes.push(`üí° Verificar produtos de limpeza das pias no ${andar}`);
                }
                
                if (mediaVaso >= 4.5 && mediaPia >= 4.5) {
                    analise.tendencias.push(`‚úÖ ${andar}: Excelente qualidade de limpeza (m√©dia ${((mediaVaso + mediaPia) / 2).toFixed(1)}/5)`);
                }
            });

            // Problemas recorrentes nos coment√°rios
            const comentarios = feedbacks.filter(f => f.comentarios && f.comentarios !== 'Nenhum').map(f => f.comentarios.toLowerCase());
            
            if (comentarios.some(c => c.includes('papel') || c.includes('higi√™nico'))) {
                analise.problemas.push('‚ùå Problema recorrente: Falta de papel higi√™nico');
                analise.sugestoes.push('üí° Implementar verifica√ß√£o de estoque de papel higi√™nico 2x ao dia');
            }
            
            if (comentarios.some(c => c.includes('sabonete') || c.includes('sab√£o'))) {
                analise.problemas.push('‚ùå Problema recorrente: Falta de sabonete');
                analise.sugestoes.push('üí° Criar checklist de reposi√ß√£o de insumos');
            }

            // Estat√≠sticas gerais
            analise.estatisticas.totalFeedbacks = feedbacks.length;
            analise.estatisticas.mediaGeral = (
                feedbacks.reduce((acc, f) => acc + (f.vaso || 0) + (f.pia || 0), 0) / 
                (feedbacks.filter(f => f.vaso || f.pia).length * 2)
            ).toFixed(2);
            analise.estatisticas.andarMaisAvaliado = Object.keys(porAndar).reduce((a, b) => 
                porAndar[a].length > porAndar[b].length ? a : b
            );
            analise.estatisticas.feedbacksAnonimos = feedbacks.filter(f => f.nome === 'An√¥nimo' || f.matricula === 'An√¥nimo').length;

            // Sugest√µes gerais
            if (feedbacks.length < 10) {
                analise.sugestoes.push('üí° Incentivar mais funcion√°rios a enviar feedbacks para an√°lises mais precisas');
            }

            if (analise.problemas.length === 0) {
                analise.tendencias.push('üéâ Nenhum problema cr√≠tico identificado! Continue o bom trabalho!');
            }

            return analise;
        }

        function exibirAnalise(analise) {
            // Tend√™ncias
            document.getElementById('tendencias').innerHTML = analise.tendencias.length > 0
                ? analise.tendencias.map(t => `<div style="padding:12px;background:#f0fdf4;border-left:4px solid #22c55e;margin-bottom:10px;border-radius:8px;">${t}</div>`).join('')
                : '<p style="color:#999;">Nenhuma tend√™ncia identificada ainda.</p>';

            // Problemas
            document.getElementById('problemas').innerHTML = analise.problemas.length > 0
                ? analise.problemas.map(p => `<div style="padding:12px;background:#fef2f2;border-left:4px solid #ef4444;margin-bottom:10px;border-radius:8px;">${p}</div>`).join('')
                : '<p style="color:#999;">‚úÖ Nenhum problema detectado!</p>';

            // Sugest√µes
            document.getElementById('sugestoes').innerHTML = analise.sugestoes.length > 0
                ? analise.sugestoes.map(s => `<div style="padding:12px;background:#fffbeb;border-left:4px solid #f59e0b;margin-bottom:10px;border-radius:8px;">${s}</div>`).join('')
                : '<p style="color:#999;">Continue o trabalho atual.</p>';

            // Estat√≠sticas
            document.getElementById('estatisticas').innerHTML = `
                <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;">
                    <div style="background:#f8fafc;padding:20px;border-radius:12px;text-align:center;">
                        <div style="font-size:32px;font-weight:900;color:#E63946;">${analise.estatisticas.totalFeedbacks || 0}</div>
                        <div style="color:#666;font-size:14px;margin-top:5px;">Total de Feedbacks</div>
                    </div>
                    <div style="background:#f8fafc;padding:20px;border-radius:12px;text-align:center;">
                        <div style="font-size:32px;font-weight:900;color:#E63946;">${analise.estatisticas.mediaGeral || 'N/A'}</div>
                        <div style="color:#666;font-size:14px;margin-top:5px;">M√©dia Geral (0-5)</div>
                    </div>
                    <div style="background:#f8fafc;padding:20px;border-radius:12px;text-align:center;">
                        <div style="font-size:28px;font-weight:900;color:#E63946;">${analise.estatisticas.andarMaisAvaliado || 'N/A'}</div>
                        <div style="color:#666;font-size:14px;margin-top:5px;">Andar Mais Avaliado</div>
                    </div>
                    <div style="background:#f8fafc;padding:20px;border-radius:12px;text-align:center;">
                        <div style="font-size:32px;font-weight:900;color:#E63946;">${analise.estatisticas.feedbacksAnonimos || 0}</div>
                        <div style="color:#666;font-size:14px;margin-top:5px;">Feedbacks An√¥nimos</div>
                    </div>
                </div>
            `;
        }

        // ============================================
        // AVALIA√á√ÉO R√ÅPIDA
        // ============================================

function showQuickFeedback() {
document.getElementById('loginScreen').style.display = 'none';
document.getElementById('quickFeedbackScreen').style.display = 'block';
}

function hideQuickFeedback() {
document.getElementById('quickFeedbackScreen').style.display = 'none';
document.getElementById('loginScreen').style.display = 'block';
document.getElementById('quickFeedbackForm').reset();
// Resetar valores dos sliders
document.getElementById('qf_banheiro_value').textContent = '0.0';
document.getElementById('qf_copa_value').textContent = '0.0';
document.getElementById('qf_relax_value').textContent = '0.0';
}

function updateSliderValue(sliderId) {
const slider = document.getElementById(sliderId);
const valueSpan = document.getElementById(sliderId + '_value');
valueSpan.textContent = parseFloat(slider.value).toFixed(1);
}

        // Inicializar status online/offline

        // Handler do formul√°rio de avalia√ß√£o r√°pida
        document.getElementById('quickFeedbackForm')?.addEventListener('submit', async function(e) {
            e.preventDefault();

            const andar = document.getElementById('qf_andar').value;
            const banheiroTipo = document.querySelector('input[name="qf_banheiro_tipo"]:checked')?.value;
            const banheiro = parseFloat(document.getElementById('qf_banheiro').value);
            const copa = parseFloat(document.getElementById('qf_copa').value);
            const relax = parseFloat(document.getElementById('qf_relax').value);
            const comentarios = document.getElementById('qf_comentarios').value.trim();
            const identificacao = document.getElementById('qf_identificacao').value.trim() || 'An√¥nimo';

            // Valida√ß√£o: pelo menos uma avalia√ß√£o deve ser maior que 0
            if (banheiro === 0 && copa === 0 && relax === 0) {
                showWarningModal('‚ö†Ô∏è', 'Avalia√ß√£o Necess√°ria', 'Por favor, avalie pelo menos um dos ambientes (Banheiro, Copa ou Relax).');
                return;
            }

            if (!banheiroTipo && banheiro > 0) {
                showWarningModal('‚ö†Ô∏è', 'Tipo de Banheiro', 'Por favor, selecione se √© Masculino ou Feminino.');
                return;
            }

            const agora = new Date();
            const data = agora.toLocaleDateString('pt-BR');
            const hora = agora.toLocaleTimeString('pt-BR');

            const avaliacaoData = {
                action: 'add',
                data: data,
                hora: hora,
                andar: andar,
                banheiro: banheiroTipo && banheiro > 0 ? `${banheiroTipo}-${banheiro.toFixed(1)}` : 'N/A',
                copa: copa > 0 ? copa.toFixed(1) : 'N/A',
                relax: relax > 0 ? relax.toFixed(1) : 'N/A',
                comentarios: comentarios || 'Nenhum',
                identificacao: identificacao
            };

            // Mostrar loading
            showWarningModal('‚è≥', 'Enviando...', 'Aguarde enquanto enviamos sua avalia√ß√£o.');

            try {
                if (!SCRIPT_URL_FEEDBACK) {
                    throw new Error('URL do script de avalia√ß√£o n√£o configurada');
                }

                await fetch(SCRIPT_URL_FEEDBACK, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(avaliacaoData)
                });

                // Sucesso
                closeWarningModal();
                showWarningModal('‚úÖ', 'Avalia√ß√£o Enviada!', 'Obrigado por contribuir com a qualidade do ambiente!');
                
                // Resetar formul√°rio mas MANTER na tela de avalia√ß√£o
                document.getElementById('quickFeedbackForm').reset();
                document.getElementById('qf_banheiro_value').textContent = '0.0';
                document.getElementById('qf_copa_value').textContent = '0.0';
                document.getElementById('qf_relax_value').textContent = '0.0';
                
                // Resetar sliders para 0
                document.getElementById('qf_banheiro').value = 0;
                document.getElementById('qf_copa').value = 0;
                document.getElementById('qf_relax').value = 0;

            } catch (error) {
                closeWarningModal();
                showWarningModal('‚ùå', 'Erro ao Enviar', 'N√£o foi poss√≠vel enviar a avalia√ß√£o. Verifique sua conex√£o ou tente novamente.');
                console.error('Erro:', error);
            }
        });

        // Inicializar status online/offline
        window.addEventListener('load', () => {
            updateOnlineStatus();
            if (isOnline && pendingSync.length > 0) {
                sincronizarDadosPendentes();
            }
        });
    </script>
</body>
</html>
